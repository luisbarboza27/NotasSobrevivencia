[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Análisis de Sobrevivencia",
    "section": "",
    "text": "Introducción\nEstas notas de clase corresponden al material teórico y práctico del curso Análisis de Sobrevivencia (Modelos de Vida) (CA0503) durante el I-2023."
  },
  {
    "objectID": "Preliminares.html#características-de-x",
    "href": "Preliminares.html#características-de-x",
    "title": "1  Preliminares",
    "section": "1.1 Características de \\(X\\):",
    "text": "1.1 Características de \\(X\\):\nA continuación explicamos cada característica:\n\n1.1.1 Función de Sobrevivencia\n\nDefinition 1.1 (Función de sobrevivencia) \\[S(x)=P(X>x)\\]\n\nEn un contexto de tiempo de vida de aparatos o máquinas, a la función \\(S(x)\\) también se le llama función de utilidad o fiabilidad.\nNote que si \\(X\\) es una variable aleatoria continua entonces \\(S(x)\\) es una función monótona decreciente. Además, si \\(f\\) es la función de densidad de \\(X\\):\n\\[S(x)=1-F(x)=\\int_x^{\\infty} f(t)dt\\] y por lo tanto: \\[f(x)=-\\frac{dS(x)}{dx}\\]\n\n\n\n\n\n\nEjemplo: Distribución Weibull\n\n\n\nEn este caso \\(S(x)=\\exp(-\\lambda x^{\\alpha})\\), para \\(\\lambda>0\\) y \\(\\alpha>0\\).\nNote que si \\(\\alpha=1\\) entonces \\(X\\sim \\text{Exponencial}(\\lambda)\\).\n\n\nA continuación se ilustra \\(S(x)\\) cuando \\(\\lambda=\\alpha=2\\):\n\nSWeibull <- function(x,lambda,alpha){\n  exp(-lambda*x^(alpha))\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = SWeibull,args= list(lambda = 2, alpha = 2))+\n  ylab('S')+\n  theme_bw()\n\n\n\n\nEn términos generales \\(S(0)=1\\) y \\(S(\\infty)=0\\), para cualquier función de sobrevivencia \\(S\\). Además, es importante recalcar que una tabla de vida o una tabla de decrementos en general es un estimador de \\(S\\) bajo un cierto conjunto de datos observados.\nNote que en el caso discreto: \\[S(x)=\\sum_{x_j>x}p(x_j)\\]\ndonde \\(p(x_j)\\) es la función de masa evaluada en \\(x_j\\).\n\n\n1.1.2 Función o Tasa de Riesgo\nEsta función se conoce en otros contextos con otros nombres:\n\nTasa de fallo condicional (aparatos electrónicos, ingeniería)\nFuerza de mortalidad (demografía)\nTasa de fallo específica por edad (epidemiología)\nHazard (en inglés)\n\n\nDefinition 1.2 (Función de riesgo) \\[h(x)=\\lim_{\\Delta x\\rightarrow 0}\\frac{P[x\\leq X < x+\\Delta x|X\\geq x]}{\\Delta x}\\]\n\nEn el caso en que \\(X\\) es una variable aleatoria continua: \\[\\begin{align*}\nh(x)&=\\lim_{\\Delta x\\rightarrow 0}\\frac{F(x+\\Delta x)-F(x)}{\\Delta x}\\cdot \\frac{1}{S(x)}\\\\\n&=\\frac{f(x)}{S(x)}=-\\frac{d}{dx}\\log (S(x))\n\\end{align*}\\]\nSi la función de riesgo se acumula en el intervalo \\([0,x]\\), se obtiene la función de riesgo acumulativo:\n\\[\\begin{align*}\nH(x)=\\int_0^xh(u)du&=-\\int_0^x \\frac{d}{du}\\log(S(u))du\\\\\n&=-\\log(S(x)).\n\\end{align*}\\]\nEntonces: \\[\nS(x)=\\exp[-H(x)]=\\exp\\left[-\\int_0^th(u)du\\right]\n\\tag{1.1}\\]\nen donde a la expresión \\(h(u)du\\) dentro de la integral se le llama probabilidad instantánea del riesgo.\nLa función de riesgo \\(h(x)\\) necesita ser solamente positiva para asegurar de que la función de sobrevivencia esté bien definida. Por lo tanto no hay muchas restricciones en la forma que tiene la función de riesgo en \\((0,\\infty)\\). Por ejemplo la función de riesgo es monótona creciente en la mayoría de situaciones en donde hay desgaste en las condiciones de existencia en seres o aparatos. También puede ser monótona decreciente en situaciones en donde el riesgo del evento disminuye conforme pasa el tiempo, por ejemplo en el caso de la mortalidad infantil. También se puede tener funciones de riesgo combinadas al tener episodios de riesgo creciente y después de un evento el riesgo disminuye hasta un cierto valor, por ejemplo cuando un paciente es intervenido en un momento de riesgo máximo y después se recupera disminuyendo su riesgo hasta un valor esperable.\n\n\n\n\n\n\nEjemplo: Distribución Weibull\n\n\n\nEn este caso la función de densidad es: \\[f(x)=-\\frac{dS(x)}{dx}=\\lambda \\alpha x^{\\alpha-1}\\exp(-\\lambda x^{\\alpha})\\] entonces: \\[h(x)= \\lambda \\alpha x^{\\alpha-1}\\] Note que si \\(\\alpha=1\\) entonces \\(h(x)=h\\alpha\\), si \\(\\alpha>1\\) la función de riesgo es creciente y si \\(\\alpha<1\\) es decreciente.\n\n\nEn el caso en que \\(\\alpha=\\lambda=2\\)\n\nhWeibull <- function(x,lambda,alpha){\n  lambda*alpha*x^(alpha-1)\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = hWeibull,args= list(lambda = 2, alpha = 2))+\n  ylab('h')+\n  theme_bw()\n\n\n\n\nPara otro caso, ver ejemplo 2.2 del (Klein and Moeschberger 2003).\nEn el caso en que \\(X\\) es una variable aleatoria discreta: \\[h(x_j)=P[X=x_j|X\\geq x_j]=\\frac{p(x_j)}{S(x_{j-1})}\\] para \\(j=1,2,\\ldots\\) y donde \\(S(x_0)=1\\). Como \\(p(x_j)=S(x_{j-1})-S(x_j)\\) entonces: \\[h(x_j)=1-\\frac{S(x_j)}{S(x_{j-1})}\\]\nAdemás:\n\\[\\begin{align*}\nS(x)&=\\prod_{x_j\\leq x}\\frac{S(x_j)}{S(x_{j-1})}\\\\\n&=\\prod_{x_j\\leq x}[1-h(x_j)]\n\\end{align*}\\]\n\n\n\n\n\n\nEjemplo: Distribución Discreta\n\n\n\nSi \\(p(x_j)=\\frac 1 3\\) para \\(j=1,2,3\\) entonces: \\[S(x)=P(X>x)=\n  \\begin{cases}\n  1 & 0\\leq x <1\\\\\n  2/3 & 1\\leq x <2 \\\\\n  1/3 & 2\\leq x <3 \\\\\n  0 & x\\geq 3\n  \\end{cases}\n\\]\ny \\[h(x)=\n    \\begin{cases}\n  1/3 & j=1 \\\\\n  1/2 & j=2 \\\\\n  1 & j=3\n    \\end{cases}\n  \\]\n\n\nEn términos generales la función de riesgo es más informativa que la función de sobrevivencia.\nSiguiendo con el caso discreto: \\[H(x)=\\sum_{x_j\\leq x}h(x_j)\\] y la relación Equation 1.1 no aplica. Otros autores prefieren definir la función de riesgo acumulada: \\[H(x)=-\\sum_{x_j\\leq x}\\log(1-h(x_j))\\] y en este caso la relación exponencial entre \\(S(x)\\) y \\(H(x)\\) sí se preserva. Note que si \\(h(x_j)\\approx 0\\) entonces la definición anterior de \\(H(x)\\) es una aproximación de Taylor de la definición original.\n\n\n1.1.3 Vida Residual Media\nEn muchas aplicaciones se requiere una estimación del tiempo esperado en que el evento va a ocurrir, dadas las condiciones actuales:\n\nDefinition 1.3 (Vida Residual Media)  \n\\[\\begin{align*}\n    mrl(x)&=E[X-x|X>x]=\\frac{\\int_x^{\\infty}(t-x)f(t)dt}{S(x)}\\\\\n    &=\\frac{\\int_x^{\\infty}S(t)dt}{S(x)}\n\\end{align*}\\]\n\nCuando \\(x=0\\), entonces \\(mrl(0)=\\int_0^{\\infty}S(t)dt=EX\\). Por otro lado se puede comprobar (Ejercicio):\n\\[\\begin{align*}\n    \\text{Var}(X)=2\\int_0^{\\infty}tS(t)dt-\\left[\\int_0^{\\infty}S(t)dt\\right]^2\n\\end{align*}\\]\nAdemás a partir de la función de sobrevivencia, también se puede calcular el cuantil correspondiente:\n\nDefinition 1.4 (Cuantil-p) Mínimo \\(x_p\\) tal que \\(S(x_p)\\leq 1-p\\): \\[\\inf\\{t:S(t)\\leq 1-p\\}\\] En el caso continuo: \\(S(x_p)=1-p\\).\n\n\n\n\n\n\n\nEjemplo: Ejemplos de vida media\n\n\n\nExponencial: Vida media \\(\\mu=EX=\\frac 1 \\lambda\\). Vida mediana \\(S(x_{0.5})=0.5\\), entonces:\n\\[S(x_{0.5})=e^{-\\lambda x_{0.5}}=\\frac 1 2 \\Rightarrow x_{0.5}=\\frac{\\log 2}{\\lambda}\\]\nVida media residual (usando la propiedad de pérdida de memoria): \\[mrl(x)=E[X-x|X>x]=E[X]=\\frac 1 \\lambda\\]\nWeibull:: \\[1-p=\\exp(-\\lambda x^{\\alpha}_p)\\Rightarrow x_p=\\left[-\\frac{\\log(1-p)}{\\lambda}\\right]^{1/\\alpha}\\]\n\n\nEn el ejemplo desarrollado anteriormente, en donde \\(\\alpha=\\lambda=2\\):\n\nalpha <- lambda <- 2\nx_05 <- (-log(1-0.5)/lambda)^(1/alpha)\nshow(x_05)\n\n[1] 0.588705\n\n\nes la vida mediana bajo el supuesto Weibull.\nEn el caso discreto: \\[mrl(x)=\\frac{(x_{i+1}-x)S(x_i)+\\sum_{j\\geq i+1}(x_{j+1}-x_j)S(x_j)}{S(x)}\\qquad \\text{para }x_i\\leq x<x_{i+1}\\]"
  },
  {
    "objectID": "Preliminares.html#modelos-paraméricos-usuales",
    "href": "Preliminares.html#modelos-paraméricos-usuales",
    "title": "1  Preliminares",
    "section": "1.2 Modelos Paraméricos Usuales",
    "text": "1.2 Modelos Paraméricos Usuales\nAdemás del caso Weibull, existen otras escogencias para modelar la función de sobrevivencia. Las más usuales son:\n\n1.2.1 Exponencial\n\\[\\begin{align*}\n    S(x)&=e^{-\\lambda x}, \\qquad x>0, \\lambda>0\\\\\n    f(x)&=\\lambda e^{-\\lambda x}\\\\\n    h(x)&=\\lambda\n\\end{align*}\\]\nRecuerden además que en el caso exponencial se cumple la propiedad de pérdida de memoria: \\(P(X\\geq x+z|X\\geq x)=P(X\\geq z)\\).\n\n\n1.2.2 Weibull\n\\[\\begin{align*}\n    S(x)&=e^{-\\lambda x^\\alpha}, \\qquad x>0, \\lambda>0, \\alpha>0\\\\\n    h(x)&=\\lambda\\alpha x^{\\alpha-1}\n\\end{align*}\\]\na los parámetros \\(\\lambda\\) y \\(\\alpha\\) se les llama de escala y forma respectivamente.\nBajo la transformación \\(Y=\\log X\\) si \\(X\\sim Weibull\\) se puede escribir \\(Y=\\mu+\\sigma E\\) donde \\(\\mu=\\frac{-\\log \\lambda}{\\alpha}\\) y \\(\\sigma=\\frac 1 \\alpha\\) y \\(E\\sim\\) Valor Extremo Estándar, es decir: \\[f_e(w)=e^{w-e^w}, \\quad w\\in  \\mathbb R\\] y \\[S_E(w)=e^{-e^w}\\]\n\n\n1.2.3 Log-normal\n\\(X\\) es una LogNormal\\((\\mu,\\sigma^2)\\) si \\(Y=\\log X\\sim N(\\mu,\\sigma^2)\\). En este caso:\n\\[\\begin{align*}\n    S(x)&=1-\\Phi\\left(\\frac{\\log x-\\mu}{\\sigma}\\right)\\\\\n    h(x)&=\\frac{\\phi(x)}{S(x)}\n\\end{align*}\\]\nEn general la tasa de riesgo \\(h(x)\\) no es monótona, por ejemplo tomando \\(\\mu=0\\) y \\(\\sigma=1\\):\n\nhLNormal <- function(x,mu,sigma){\n  dnorm(x)/plnorm(x,meanlog = mu,sdlog = sigma,lower.tail = F)\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = hLNormal,args= list(mu = 0, sigma = 1))+\n  ylab('h')+\n  theme_bw()\n\n\n\n\nlo cual no necesariamente tiene sentido en muchas aplicaciones.\n\n\n1.2.4 Log-logístico\n\\(X\\) es una variable aleatoria log-logística si \\(Y=\\log X\\sim\\) logístico: \\[f_Y(y)=\\frac{e^{\\frac{y-\\mu}{\\sigma}}}{\\sigma\\left[1+e^{\\frac{y-\\mu}{\\sigma}}\\right]^2},\\qquad y \\in \\mathbb R\\]\ncon función de tasa y función de sobrevivencia:\n\\[\\begin{align*}\n    h(x)&=\\frac{\\alpha \\lambda x^{\\alpha-1}}{1+\\lambda x^\\alpha}\\qquad \\text{más flexible que Weibull}\\\\\n    S(x)&=\\frac{1}{1+\\lambda x^\\alpha}\n\\end{align*}\\]\ncon \\(\\alpha=\\frac 1 \\sigma>0\\), \\(\\lambda=e^{-\\mu/\\sigma}\\)\n\n\n1.2.5 Gamma\n\\[f(x)=\\frac{\\lambda^\\beta x^{\\beta-1}e^{-\\lambda x}}{\\Gamma(\\beta)},\\qquad \\lambda,\\beta,x>0\\] Si \\(\\beta=1\\): exponencial, \\(\\beta\\longrightarrow \\infty\\): Normal. Además \\(h(x)\\) tiene una forma complicada (ver Klein) pero no es muy flexible (solamente crece o decrece).\n\n\n1.2.6 Gompertz\n\\[\\begin{align*}\n    f(x)&=\\theta \\exp(\\alpha x)\\exp \\left(\\frac \\theta \\alpha (1-e^{\\alpha x})\\right)\\\\\n    h(x)&=\\theta \\exp(\\alpha x)\n\\end{align*}\\]\nen este caso si \\(\\alpha>1\\) y \\(\\theta>0\\) entonces \\(h\\) es monótona creciente. Además podemos generalizar levemente la ley anterior por medio del modelo de Makeham: \\[h(x)=\\theta \\exp(\\alpha x)+\\lambda\\]\nla cual permite que \\(h\\) sea más flexible.\n\nhGompertz <- function(x,alpha,theta,lambda){\n  theta*exp(alpha*x)+lambda\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = hGompertz,args= list(alpha = 0.5, theta = 0.5,lambda = 0.2))+\n  ylab('h')+\n  theme_bw()"
  },
  {
    "objectID": "Preliminares.html#modelos-de-regresión-para-datos-de-sobrevivencia",
    "href": "Preliminares.html#modelos-de-regresión-para-datos-de-sobrevivencia",
    "title": "1  Preliminares",
    "section": "1.3 Modelos de regresión para datos de sobrevivencia",
    "text": "1.3 Modelos de regresión para datos de sobrevivencia\nSea \\(X\\) la variable aleatoria de tiempo de fallo u ocurrencia de riesgo. Usualmente la distribución de la variable \\(X\\) se asocia con variables explicativas o covariables:\n\\[Z^T=(Z_1,\\ldots,Z_p)\\]\ndonde estas covariables pueden ser cuantitativas o categóricas, y no se descarta la posibilidad de que estas dependan del tiempo \\(x\\):\n\\[Z^T(x)=(Z_1(x),\\ldots,Z_p(x))\\]\nUsualmente los modelos de regresión en este contexto se definen de dos formas:\nEnfoque 1\nUsar la variable dependiente \\(X\\) como variable transformada según \\(Y=\\log(X)\\) y hacer la regresión lineal múltiple:\n\\[Y=\\mu+\\gamma^TZ+\\sigma \\epsilon\\]\ndonde \\(\\gamma^T=(\\gamma_1,\\ldots,\\gamma_p)\\) es un vector de coeficientes y \\(\\epsilon\\) es un error independiente que se puede distribuir según:\n\nUna normal estándar (Regresión log-normal).\nUna distribución de valor extremo estándar (Regresión Weibull)\nUna distribución logística (Regresión log-logística).\n\nMétodo de estimación: Máxima Verosimilitud.\nSea \\(S_0(x)\\) la función de sobrevivencia de \\(X=e^Y\\) cuando \\(Z=0\\), es decir es la función de sobrevivencia de \\(\\exp(\\mu+\\sigma \\epsilon)\\). Entonces:\n\\[\\begin{align*}\n    P[X>x|Z]&=P[Y>\\log x|Z]=P[\\mu+\\gamma^TZ+\\sigma \\epsilon>\\log x|Z]\\\\\n    &=P[\\exp(\\mu+\\sigma \\epsilon)>x\\exp(-\\gamma^T Z)|Z]=S_0(x\\exp(-\\gamma^T Z)).\n\\end{align*}\\]\nConclusión: el efecto de las covariables \\(Z\\) en la función de sobrevivencia de \\(X\\) es el escalamiento del tiempo \\(x\\) a través del factor \\(\\exp(-\\gamma^T Z)\\). Por este motivo a este modelo se le llama modelo de tiempo de fallo acelerado. Su función de riesgo es (ejercicio): \\[h(x|Z)=h_0\\left[x\\exp(-\\gamma^T Z)\\right]\\exp(-\\gamma^T Z)\\]\n\n\n\n\n\n\nEjemplo: Regresión Weibull\n\n\n\nSea \\(X\\sim Weibull(\\lambda, \\alpha)\\). Si \\(Y=\\log X\\) entonces \\(Y=\\mu+\\sigma W\\) donde \\(\\mu=-\\frac{\\log \\lambda}{\\alpha}\\), \\(\\sigma=\\frac 1 \\alpha\\) y \\(W\\sim \\text{VE-Standard}\\), es decir: \\[f_W(w)=\\exp\\left(w-e^w\\right)\\qquad w\\in \\mathbb R\\]\nSi \\(Z_1=1\\) en el vector de covariables \\(Z\\), entonces bajo el modelo de regresión Weibull, se puede calcular:\n\\[\\begin{align*}\n    S_Y(y|Z)&=P[Y>y|Z]=P\\left[W>\\frac{y-\\gamma^T Z}{\\sigma}|Z\\right]\\\\\n    &=\\exp\\left[-\\exp\\left[\\frac{y-\\gamma^T Z}{\\sigma}\\right]\\right]\n\\end{align*}\\]\ny cambiando a la variable original \\(X\\):\n\\[\\begin{align*}\nS_X(x|Z)&=\\exp\\left[-\\exp\\left[\\frac{\\log x-\\gamma^T Z}{\\sigma}\\right]\\right]=\\exp\\left[-x^{1/\\sigma}\\exp\\left[-\\frac{\\gamma^T Z}{\\sigma}\\right]\\right]\\\\\n&=\\exp\\left[-\\left[x\\exp(-\\gamma^T Z)\\right]^\\alpha\\right]=S_0(x\\exp(-\\gamma^T Z))\n\\end{align*}\\] donde \\(S_0\\) es la función de sobrevivencia Weibull.\n\n\nEnfoque 2\nModelación de la tasa de riesgo condicional\nEn este enfoque se trabaja con dos tipos de modelos:\n\nModelos con tasa de riesgo multiplicativa:\n\n\\[\nh(x|Z)=h_0(x)c(\\beta^T Z)\n\\tag{1.2}\\]\ndonde \\(h_0\\) puede ser una función paramétrica o arbitraria y \\(c\\) es una función arbitraria no-negativa. Cuando\n\\[c(\\beta^T Z)=\\exp(\\beta^T Z)\\]\nal modelo en Equation 1.2 se le llama Modelo de Cox. Para este último modelo, si existe dos individuos con distinto conjunto de covariables \\(Z_1\\) y \\(Z_2\\). Entonces:\n\\[\\frac{h(x|Z_1)}{h(x|Z_2)}=\\frac{c(\\beta^TZ_1)}{c(\\beta^TZ_2)}\\]\nlo cual es independiente de \\(x\\) (propiedad de riesgos proporcionales). Además, note que\n\\[\\begin{align*}\n    S(x|Z)&=\\exp\\left[-\\int_0^xh(u|Z)du\\right]=\\exp\\left[-c(\\beta^T Z)\\int_0^xh_0(u)du\\right]\\\\\n    &=S_0(x)^{c(\\beta^T Z)}.\n\\end{align*}\\]\n\n\n\n\n\n\nEjemplo: Regresión Weibull\n\n\n\nEn el caso Weibull: \\(h_0(x)=\\alpha \\lambda x^{\\alpha-1}\\) y la función de riesgo condicional en el caso de un modelo de Cox es: \\[h(x|Z)=\\alpha \\lambda x^{\\alpha-1}\\exp(\\beta^T Z)\\]\nNote que en este caso: \\[\\begin{align*}\n    S(x|Z)&=S_0(x)^{c(\\beta^T Z)}\\\\\n    &=\\exp[-\\lambda (x\\exp(\\beta^T Z/\\alpha))^\\alpha]=S_0(x\\exp(\\beta^T Z/\\alpha))\n\\end{align*}\\]\npor lo cual el modelo de regresión Weibull se puede expresar como modelo de tiempo de fallo acelerado o bien como modelo de riesgos proporcionales. (único caso)\n\n\n\nModelos con tasa de riesgo aditiva: \\[h(x|Z)=h_0(x)+\\sum_{j=1}^pZ_j(x)\\beta_j(x)\\]\n\nEste tipo de modelo tiene dificultades extra, por ejemplo los parámetros \\(\\beta_j(x)\\) deben ser seleccionados de manera que la tasa de riesgo \\(h(x|Z)\\) sea positiva. Por otro lado también \\(\\beta_j(x)\\) puede depender del tiempo \\(x\\)."
  },
  {
    "objectID": "Preliminares.html#modelos-de-riesgos-en-competencia",
    "href": "Preliminares.html#modelos-de-riesgos-en-competencia",
    "title": "1  Preliminares",
    "section": "1.4 Modelos de riesgos en competencia",
    "text": "1.4 Modelos de riesgos en competencia\nSi \\(T\\) denota el tiempo de fallo o bien el tiempo hasta que ocurre un evento. En este contexto, puede ser que existan \\(K\\) distintas causas del fallo. Por ejemplo, ante el evento de muerte a los 65 años, esta se puede deber a muchas causas.\nSea \\(X_i\\) el tiempo hasta que ocurra el \\(i\\)-ésimo riesgo en competencia. Sea \\(T=\\min(X_1,\\ldots,X_K)\\) y considere la variable \\(\\delta\\) que asume el valor \\(i\\) si \\(T=X_i\\). Definimos la tasa del riesgo \\(i\\)-ésimo como:\n\\[\\begin{align*}\n   h_i(t)&=\\lim_{\\Delta t\\rightarrow 0}\\frac{P[t\\leq T < t+\\Delta t, \\delta=i|T\\geq t]}{\\Delta t}\\\\\n   &=\\lim_{\\Delta t\\rightarrow 0}\\frac{P[t\\leq X_i < t+\\Delta t|X_j\\geq t, \\quad j=1,\\ldots,K]}{\\Delta t}\n\\end{align*}\\]\nEntonces, si \\(S(t_1,\\ldots,t_K)=P[X_1>t_1,\\ldots,X_K>t_K]\\)\n\\[\\begin{align*}\n   h_T(t)=\\sum_{i=1}^Kh_i(t) \\quad \\text{y} \\quad h_i(t)=\\frac{-\\frac{\\delta}{\\delta t_i}S(t_1,\\ldots,t_k)|_{t_1=\\cdots=t_K=t}}{S(t,\\ldots,t)}\n\\end{align*}\\]\nCaso especial: si los \\(K\\) riesgos en competencia son independientes:\n\\[h_i(t)=\\frac{-\\frac{\\delta}{\\delta t_i}\\prod_{j=1}^KS_j(t_j)|_{t_1=\\cdots=t_K=t}}{\\prod_{j=1}^KS_j(t)}=\\frac{-\\frac{\\delta}{\\delta t_i}S_i(t_i)|_{t_i=t}}{S_i(t)}\\]\nEn el caso no independiente (ver Ejemplo 2.7 del Klein).\nNota: es fundamental hacer algún supuesto sobre la estructura de dependencia en los tiempos de fallo, ya que al acontecer el riesgo en una causa especifica no se observó el tiempo de fallo en los riesgos restantes.\nEn el contexto de riesgos en competencia, no siempre se utiliza la tasas de riesgo para sintetizar la información, sino que también se utiliza probabilidades con distinta interpretación:\n\nProbabilidades crudas: probabilidad de muerte de un individuo bajo una causa en particular, cuando el resto de las causas también influyen en el comportamiento de sobrevivencia del individuo.\n\nSe calculan a través de la función de incidencia acumulativa:\n\\[\\begin{align*}\n   F_i(t)&=P[T\\leq t, \\delta = i]\\\\\n   &=\\int_0^th_i(u)\\exp[-H_T(u)]du\n\\end{align*}\\]\ndonde el último término exponencial es la tasa acumulativa de todos los riesgos en competencia. Note que \\(F_i\\) no es una distribución ya que:\n\\[F_i(\\infty)=P[\\delta = i]\\neq 1\\]\nAl aplicar la función \\(F_i\\) se puede calcular las probabilidades crudas directamente.\n\nProbabilidades netas: Probabilidad de muerte de un individuo donde la causa de muerte o riesgo de interés es el único. Usando la notación:\n\n\\[S_i(t)=S(0,\\ldots,0,\\stackrel{\\text{posicion }i}{t},0,\\ldots,0)\\]\nEn el caso independiente:\n\\[\\begin{align*}\n   S_i(t)&=\\exp(0)\\cdots \\exp\\left(-\\int_0^th_i(u)du\\right)\\cdots \\exp(0)\\\\\n   &=\\exp\\left[-\\int_0^t\\frac{dF_i(u)}{S_T(u)}du\\right]\n\\end{align*}\\]\n\nProbabilidades parciales crudas: Probabilidades de muerte en un contexto en donde algunos riesgos han sido eliminados. Sean \\(J\\): conjunto de causas o riesgos de interés. Defina:\n\n\\[T^J=\\min(X_i,i\\in J)\\quad \\text{y} \\quad F_i^J(t)=P[T^J\\leq t,\\delta=i]\\]\npara \\(i \\in J\\). Definimos la tasa de riesgo cruda parcial:\n\\[\\lambda_i^J=\\frac{-\\frac{\\delta S(t_1,\\ldots,t_K)}{\\delta t_i}\\Big \\vert_{t_j=t, j\\in J; t_j=0, j\\in J^C}}{S(t_1,\\ldots,t_K)\\Big \\vert_{t_j=t, j\\in J; t_j=0, j\\in J^C}}\\]\nEntonces:\n\\[F_i^J(t)=P[T^J\\leq t, \\delta=i]=\\int_0^t\\lambda^J_i(x)\\exp\\left[-\\sum_{j\\in J}\\int_0^t\\lambda_j^J(u)du\\right]dx\\]\nNote que en el caso independiente, la tasa de riesgo cruda parcial es:\n\\[\\lambda_i^J(t)=\\frac{dF_i(t)/dt}{S_T(t)}\\]"
  },
  {
    "objectID": "Preliminares.html#censura-y-truncamiento",
    "href": "Preliminares.html#censura-y-truncamiento",
    "title": "1  Preliminares",
    "section": "1.5 Censura y Truncamiento",
    "text": "1.5 Censura y Truncamiento\nConceptos de censura y truncamiento:\n\nDefinition 1.5 (Censura) Información de sobrevivencia de un individuo, que solamente se conoce con respecto a un intervalo y no a un punto fijo de occurrencia del evento de riesgo.\n\n\nDefinition 1.6 (Truncamiento) Restricción de entrada o salida a un estudio de sobrevivencia.\n\n\n1.5.1 Censura por la derecha\nTambién conocida como Censura Tipo I:\n\nDefinition 1.7 (Censura Tipo I) Evento de interés es observado solamente si ocurre antes de un tiempo específico.\n\nRecordando la notación que hemos usando hasta el momento, si \\(X\\) es el tiempo aleatorio en que ocurre el riesgo, \\(X\\sim f(x)\\) con función de sobrevivencia \\(S(x)\\) y además \\(C_r\\) denota el tiempo de censura fijo, entonces \\(X\\) es observado solamente si \\(X\\leq C_r\\) y si \\(X>C_r\\) decimos que el evento es “censurado”.\nEn este caso los datos pueden ser representados en pares:\n\\[(T,\\delta)\\]\ndonde \\(\\delta=1\\) indica que el evento se observa y \\(\\delta=0\\) indica que el evento es censurado. Además \\(T=\\min(X,C_r)\\).\n\n\n\n\n\n\nEjemplo: Ejemplo de Censura\n\n\n\nEn un estudio clínico, hay una serie de ratones alimentados con un agente cancerígeno. Se rastrea el tiempo de vida en cada ratón, hasta la muerte o bien hasta una censura pre-establecida (sacrificio):\n\n\n\n\n\nCensura Tipo I\n\n\n\n\nTambién se puede dar el caso de que el tiempo de censura entre observaciones no sea único (censura progresiva):\n\n\n\n\n\nCensura Tipo I-progresiva\n\n\n\n\nTambién se puede dar el caso de que no todos los sujetos de prueba (ratones) estuvieron al inicio del estudio (Censura Tipo I-generalizada):\n\n\n\n\n\nCensura Tipo I-generalizada\n\n\n\n\n\n\nOtra forma de representar los tiempos de sobrevivencia y censura en una muestra es a través de un Diagrama de Lexis, en donde se representa en el eje x el tiempo transcurrido (calendario) del estudio y en el eje y el tiempo transcurrido de cualquier individuo en el estudio:\n\n\n\n\n\nDiagrama de Lexis\n\n\n\n\nOtro tipo de esquema de censura por la derecha es la Censura Tipo II: en donde un estudio termina cuando fallan los primeros \\(r\\) individuos en un grupo de \\(n\\) individuos. Este tipo de esquema se suele aplicar en lotes de equipo electrónico por ejemplo o sistemas que están conectados en red. En este caso \\(r\\): número de fallos, \\(n-r\\): número de censuras y \\(T_{(r)}\\): tiempo de censura del estudio.\nTambién se puede utilizar un esquema progresivo para la censura tipo II. Suponga que hay \\(r_1\\) fallos de un total de \\(n\\) individuos. Además asuma que se censuran \\(n_1-r_1\\) individuos (\\(n_1<n\\)) con un primer tiempo de censura \\(T_{(r_1)}\\). El proceso puede continuar con los \\(n-n_1\\) individuos restantes, ocurre \\(r_2\\) fallos (\\(r_2<n-n_1\\)), \\(n_2-r_2\\) censuras (\\(n_1+n_2<n\\)) y \\(T_{(n_1+r_2)}\\) es el segundo tiempo de censura y así sucesivamente.\n\n\n1.5.2 Censura por la izquierda o de intervalo\nSuponga que para un tiempo de vida \\(X\\) existe un tiempo \\(C_\\ell\\) en donde el evento de riesgo ocurrió antes de que el sujeto fuera observado. En este caso el tiempo \\(X\\) es observado si \\(X>C_\\ell\\). Al igual que en el caso de censura por la derecha, podemos usar la notación:\n\\[(T,\\epsilon)\\]\ndonde \\(T=X\\) si \\(\\epsilon=1\\) (observado) y \\(T=C_\\ell\\) si \\(\\epsilon=0\\) (censurado), es decir \\(T=\\max(X,C_\\ell)\\). Por ejemplo, si un estudio busca cuantificar el riesgo de fumar marihuana por primera vez (Klein and Moeschberger 2003), un individuo tendría una censura por la izquierda si no recuerda la primera vez que fumó, pero afirma que sí la ha consumido antes del inicio del estudio.\nSi por otro lado se combina la censura por la derecha y por la izquierda, se denomina censura doble, y en este caso los datos son:\n\\[(T,\\delta)\\quad \\text{donde} \\quad T=\\max\\left(\\min(X,C_r),C_\\ell\\right)\\]\ny\n\\[\\begin{align*}\n\\delta=\\begin{cases}\n1 & \\text{si $T$ ocurre entre $C_\\ell$ y $C_r$}\\\\\n0 & \\text{censura por la derecha}\\\\\n-1 & \\text{censura por la izquierda}\n\\end{cases}\n\\end{align*}\\]\nFinalmente, la censura por intervalo se utiliza en estudios en donde un paciente o individuo en general es visitado periódicamente y lo único que se sabe es que el evento de interés ocurrió en un intervalo \\((L_i,R_i]\\) cuyos extremos corresponde a los momentos de visitas consecutivas.\n\n\n1.5.3 Truncamiento\nEl truncamiento ocurre cuando en un estudio solamente se incluyen y observan individuos cuyos eventos ocurren en \\((Y_L,Y_R)\\). Si el evento ocurriera fuera de ese intervalo entonces no se incluye en el estudio.\nSi \\(Y_R=\\infty\\) entonces X es observado \\(\\Leftrightarrow Y_L<X\\) (truncamiento por la izquierda). Por ejemplo: (1) si se estudia la aparición de una enfermedad desde una fecha fija o (2) si se estudia el evento de muerte desde el inicio de un estudio clínico.\nNota: Muchas veces el truncamiento por la izquierda es acompañado con censura por la derecha.\nPara el caso de truncamiento por la derecha: si \\(Y_L=0\\): \\(X\\) es observado \\(\\Leftrightarrow X\\leq Y_R\\) (ver Ejemplo 3.8 del (Klein and Moeschberger 2003))."
  },
  {
    "objectID": "Preliminares.html#verosimilitud-bajo-censura-y-truncamiento",
    "href": "Preliminares.html#verosimilitud-bajo-censura-y-truncamiento",
    "title": "1  Preliminares",
    "section": "1.6 Verosimilitud bajo censura y truncamiento",
    "text": "1.6 Verosimilitud bajo censura y truncamiento\nSupuesto: tiempos de ocurrencia de evento y tiempos de censura son independientes. Cada tipo de censura/truncamiento aporta distintos factores a la verosimilitud completa de los datos:\n\nTiempo exacto del evento en estudio: \\(f(x)\\)\nCensura por la derecha: \\(P(X>C_r)=S(C_r)\\)\nCensura por la izquierda: \\(P(X<C_\\ell)=1-S(C_\\ell)\\)\nCensura en intervalo: \\(P(L<X<R)=S(L)-S(R)\\)\nTruncamiento por la izquierda: \\(f(x|X>Y_L)=\\frac{f(x)}{S(Y_L)}\\)\nTruncamiento por la derecha: \\(f(x|X<Y_R)=\\frac{f(x)}{1-S(Y_R)}\\)\n\nPor lo tanto la verosimilitud con datos censurados se puede escribir como:\n\\[L\\propto \\prod_{i \\in D}f(x_i)\\prod_{i \\in R}S(C_r)\\prod_{i \\in L}\\left(1-S(C_\\ell)\\right) \\prod_{i \\in I}[S(L_i)-S(R_i)]\\]\ndonde\n\n\\(D\\): conjunto de eventos observables.\n\\(R\\): conjunto de observaciones con censura por la derecha.\n\\(L\\): conjunto de observaciones con censura por la izquierda.\n\\(I\\): conjunto de observaciones con censura por intervalo.\n\nPara datos truncados por la izquierda y censurados por la derecha con intervalo de truncamiento \\((Y_{L_i},Y_{R_i})\\) independientes del \\(i\\)-ésimo momento de muerte, se reemplaza \\(f(x_i)\\) y \\(S(C_i)\\) (\\(C_i\\): tiempo de censura \\(i\\)-ésima) por:\n\\[\\frac{f(x_i)}{S(Y_{L_i})-S(Y_{R_i})} \\quad \\text{y} \\quad \\frac{S(C_i)}{S(Y_{L_i})-S(Y_{R_i})}\\]\nEn el caso en donde cada individuo tiene una distribución de riesgo distinta (Ejemplo: regresión):\n\\[L\\propto \\prod_{i \\in D}f_i(x_i)\\prod_{i \\in R}S_i(C_r)\\prod_{i \\in L}\\left(1-S_i(C_\\ell)\\right) \\prod_{i \\in I}[S_i(L_i)-S_i(R_i)]\\]\nCaso particular: censura tipo I (por la derecha)\nSi \\(\\delta=0\\) (censura):\n\\[\\begin{align*}\n   P[T,\\delta=0]&=P[T=C_r|\\delta=0]P[\\delta=0]=P[\\delta=0]\\\\\n   &=P[X>C_r]=S(C_r).\n\\end{align*}\\]\nSi \\(\\delta = 1\\):\n\\[\\begin{align*}\n   P[T,\\delta=1]&=P[T=X|\\delta=1]P[\\delta=1]\\\\\n   &=P[T=X|X\\leq C_r]P[X\\leq C_r]\\\\\n   &=\\frac{f(t)}{1-S(C_r)}[1-S(C_r)]=f(t).\n\\end{align*}\\]\nEntonces el aporte de \\(T=t\\) a la verosimilitud es:\n\\[[f(t)]^\\delta[S(t)]^{1-\\delta}\\]\nSi se tiene una muestra aleatoria de pares \\((T_i,\\delta_i)\\), para \\(i=1,\\ldots,n\\):\n\\[L=\\prod_{i=1}^nf(t_i)^{\\delta_i}[S(t_i)]^{1-\\delta_i}\\]\nComo \\(f(t_i)=h(t_i)S(t_i)\\) entonces:\n\\[L=\\prod_{i=1}^nh(t_i)^{\\delta_i}S(t_i)^{\\delta_i}[S(t_i)]^{1-\\delta_i}=\\prod_{i=1}^nh(t_i)^{\\delta_i}\\exp(-H(t_i))\\]\n\n\n\n\n\n\nEjemplo: Caso Exponencial\n\n\n\nAsuma que \\(X\\sim \\text{Exponencial}(\\lambda)\\) con \\(f(x)=\\lambda \\exp(-\\lambda x)\\), entonces:\n\\[\\begin{align*}\n   L&=\\prod_{i=1}^n [\\lambda \\exp(-\\lambda t_i)]^{\\delta_i}[\\exp(-\\lambda t_i)]^{(1-\\delta_i)}\\\\\n   &=\\lambda^r\\exp(-\\lambda S_T)\n\\end{align*}\\]\ndonde \\(r=\\sum \\delta_i\\) (total de eventos observados) y \\(S_T=\\sum_{i=1}^n t_i\\) (total de tiempo en el estudio)."
  },
  {
    "objectID": "Preliminares.html#laboratorio",
    "href": "Preliminares.html#laboratorio",
    "title": "1  Preliminares",
    "section": "1.7 Laboratorio",
    "text": "1.7 Laboratorio\n\n1.7.1 Ejemplos de datos de análisis de sobrevivencia\n\nlibrary(tidyverse)\nlibrary(KMsurv)\n\n\n1.7.1.1 Ejemplo 1\nEnsayo clínico de un fármaco, 6-mercaptopurina (6-MP), frente a un placebo en 42 niños con leucemia aguda. El ensayo se llevó a cabo en 11 hospitales estadounidenses. Se seleccionaron pacientes que habían experimentado una remisión completa o parcial de su leucemia inducida por el tratamiento con el fármaco prednisona. (Una remisión completa o parcial significa que la mayoría o todos los signos de la enfermedad habían desaparecido de la médula ósea). El ensayo se realizó emparejando pares de pacientes en un hospital determinado por estado de remisión (completa o parcial) y aleatorizando dentro del par para recibir terapia de mantenimiento con 6-MP o placebo. Los pacientes fueron seguidos hasta que su leucemia regresó (relapse) o hasta el final del estudio (en meses).\n\ndata(\"drug6mp\")\n#help(\"drug6mp\")\n\nglimpse(drug6mp)\n\nRows: 21\nColumns: 5\n$ pair    <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…\n$ remstat <int> 1, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 1, 2, 2, 2, 1, 1, 2, 2, 2, 2\n$ t1      <int> 1, 22, 3, 12, 8, 17, 2, 11, 8, 12, 2, 5, 4, 15, 8, 23, 5, 11, …\n$ t2      <int> 10, 7, 32, 23, 22, 6, 16, 34, 32, 25, 11, 20, 19, 6, 17, 35, 6…\n$ relapse <int> 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0\n\n\n\nggplot()+geom_histogram(data = drug6mp,mapping = aes(t2),bins = 6,fill='white',col = 'black')+\n  theme_bw()\n\n\n\n\n\ntable(drug6mp$relapse)\n\n\n 0  1 \n12  9 \n\n\n\n\n1.7.1.2 Ejemplo 2\nEvaluación del tiempo hasta la primera infección del sitio de salida (en meses) en pacientes con insuficiencia renal, 43 pacientes utilizaron un catéter colocado quirúrgicamente (Grupo 1), y 76 pacientes utilizaron una colocación percutánea de su catéter (Grupo 2).\n\ndata(kidney)\n#help(kidney)\n\nglimpse(kidney)\n\nRows: 119\nColumns: 3\n$ time  <dbl> 1.5, 3.5, 4.5, 4.5, 5.5, 8.5, 8.5, 9.5, 10.5, 11.5, 15.5, 16.5, …\n$ delta <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0…\n$ type  <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n\n\n\nggplot()+geom_histogram(data = kidney,mapping = aes(time),bins = 6,fill='white',col = 'black')+\n  theme_bw()\n\n\n\n\n\ntable(kidney$delta)\n\n\n 0  1 \n93 26 \n\n\n\n\n1.7.1.3 Ejemplo 3\nEstudio diseñado para determinar si las pacientes con cáncer de mama, clasificadas originalmente como negativas en los ganglios linfáticos por microscopía de luz estándar (SLM), podrían ser clasificadas de manera más precisa mediante examen inmunohistoquímico (IH) de sus ganglios linfáticos con un cóctel de anticuerpos monoclonales anticitokeratina. Se seleccionaron 45 pacientes con cáncer de mama femenino y ganglios linfáticos axilares negativos y un seguimiento mínimo de 10 años del Registro de Cáncer de los Hospitales de la Universidad Estatal de Ohio. De las 45 pacientes, 9 fueron positivas para inmunoperoxidasa, y las 36 restantes permanecieron negativas.\n\ndata(btrial)\n#help(btrial)\n\nglimpse(btrial)\n\nRows: 45\nColumns: 3\n$ time  <int> 19, 25, 30, 34, 37, 46, 47, 51, 56, 57, 61, 66, 67, 74, 78, 86, …\n$ death <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0…\n$ im    <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n\n\n\ntabla_1 <- btrial %>% group_by(death,im) %>% summarise(total = n()) %>%\n  ungroup() %>% mutate(total = round(total / sum(total)*100,2))\n\n`summarise()` has grouped output by 'death'. You can override using the\n`.groups` argument.\n\nshow(tabla_1)\n\n# A tibble: 4 × 3\n  death    im total\n  <int> <int> <dbl>\n1     0     1 44.4 \n2     0     2  2.22\n3     1     1 35.6 \n4     1     2 17.8 \n\n\n\ntabla_2 <- btrial %>% group_by(death,im) %>% summarise(total = round(mean(time),2)) \n\n`summarise()` has grouped output by 'death'. You can override using the\n`.groups` argument.\n\nshow(tabla_2)\n\n# A tibble: 4 × 3\n# Groups:   death [2]\n  death    im total\n  <int> <int> <dbl>\n1     0     1 148. \n2     0     2 144  \n3     1     1  52.1\n4     1     2  59.9\n\n\n\n\n1.7.1.4 Ejemplo 4\nMuestra de 101 pacientes con leucemia mieloide aguda avanzada reportados en el Registro Internacional de Trasplante de Médula Ósea. 51 de estos pacientes recibieron un trasplante autólogo de médula ósea en el que, después de altas dosis de quimioterapia, su propia médula fue reinfundida para reemplazar su sistema inmunológico destruido. 50 pacientes recibieron un trasplante alogénico de médula ósea en el que se utilizó médula de un hermano compatible en cuanto a antígenos leucocitarios humanos (HLA) para reponer sus sistemas inmunológicos. Una pregunta importante en el trasplante de médula ósea es la comparación de la efectividad de estos dos métodos de trasplante medida por la duración de la supervivencia libre de leucemia de los pacientes, el tiempo que viven y cuánto tiempo permanecen libres de enfermedad después de sus trasplantes.\n\ndata(\"alloauto\")\n#help(\"alloauto\")\n\nglimpse(alloauto)\n\nRows: 101\nColumns: 3\n$ time  <dbl> 0.030, 0.493, 0.855, 1.184, 1.283, 1.480, 1.776, 2.138, 2.500, 2…\n$ type  <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ delta <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1…\n\n\n\nalloauto <- alloauto %>% mutate(type = factor(type))\n\nggplot()+geom_histogram(data = alloauto,aes(x = time),bins = 7,fill='white',col = 'black')+\n  facet_wrap(facets = vars(type),nrow = 2)+\n  theme_bw()\n\n\n\n\n\nlibrary(asaur)\nhead(gastricXelox)\n\n  timeWeeks delta\n1         4     1\n2         8     1\n3         8     1\n4         8     1\n5         9     1\n6        11     1\n\ndim(gastricXelox)\n\n[1] 48  2\n\n\n\n\n1.7.1.5 Ejemplo 5\nEste es un ensayo clínico de Fase II (muestra única) de quimioterapia Xeloda y oxaliplatino (XELOX) administrado antes de la cirugía a 48 pacientes con cáncer gástrico avanzado con metástasis en los ganglios linfáticos paraaórticos (Wang et al.).\n\ntimeWeeks: tiempo de sobrevivencia en semanas.\ndelta: variable de censura: (1) muerte, (2) censura.\n\n\nhead(prostateSurvival)\n\n  grade stage ageGroup survTime status\n1  mode   T1c      80+       18      0\n2  mode  T1ab    75-79       23      0\n3  poor   T1c    75-79       37      0\n4  mode    T2    70-74       27      0\n5  mode   T1c    70-74       42      0\n6  poor    T2    75-79       38      2\n\ndim(prostateSurvival)\n\n[1] 14294     5\n\n\n\n\n1.7.1.6 Ejemplo 6\nDatos simulados de 14,294 pacientes con cáncer de próstata basados en análisis detallados de riesgos competitivos publicados por Lu-Yao et al. Para cada paciente, tenemos la clasificación histológica (poco o moderadamente diferenciado), la edad del diagnóstico (66-70, 71-75, 76-80 y 80+), el estadio del cáncer (T1c si se diagnosticó mediante una prueba de detección de antígeno específico de próstata, T1ab si se diagnosticó clínicamente sin cribado, o T2 si fue palpable en el momento del diagnóstico), el tiempo de supervivencia (días desde el diagnóstico hasta la muerte o la última fecha de seguimiento) y un indicador (“estado”) que indica si el paciente murió de cáncer de próstata (estado = 1), murió de otra causa (estado = 2) o seguía vivo en la última fecha de seguimiento (estado = 0).\n\nageGroup: edad de diagnóstico.\nstage: etapa del cáncer.\nsurvTime: tiempo de sobrevivencia.\nstatus: Muerte por cáncer de próstata (1), muerte por otra causa (2), sobrevivencia al final del estudio (0).\n\n\nhead(pharmacoSmoking)\n\n   id ttr relapse         grp age gender     race employment yearsSmoking\n1  21 182       0   patchOnly  36   Male    white         ft           26\n2 113  14       1   patchOnly  41   Male    white      other           27\n3  39   5       1 combination  25 Female    white      other           12\n4  80  16       1 combination  54   Male    white         ft           39\n5  87   0       1 combination  45   Male    white      other           30\n6  29 182       0 combination  43   Male hispanic         ft           30\n  levelSmoking ageGroup2 ageGroup4 priorAttempts longestNoSmoke\n1        heavy     21-49     35-49             0              0\n2        heavy     21-49     35-49             3             90\n3        heavy     21-49     21-34             3             21\n4        heavy       50+     50-64             0              0\n5        heavy     21-49     35-49             0              0\n6        heavy     21-49     35-49             2           1825\n\ndim(pharmacoSmoking)\n\n[1] 125  14\n\n\n\n\n1.7.1.7 Ejemplo 7\nEl propósito de este estudio (Steinberg et al. [63]) fue evaluar la duración prolongada de una combinación de tres medicamentos versus la terapia con parche de nicotina sola en fumadores con enfermedades médicas. Los pacientes con antecedentes de tabaquismo fueron asignados al azar a la combinación de tres medicamentos o a la terapia con parche, y se siguieron durante un máximo de seis meses. La variable de resultado primaria fue el tiempo desde la asignación aleatoria hasta la recaída (vuelta al tabaquismo); las personas que permanecieron sin fumar durante seis meses fueron censuradas.\n\nttr: tiempo en dias hasta una recaída (volver a fumar).\nrelapse: (1): volvió a fumar vs (0): censura.\nemployment: jornada laboral.\n\n\n\n1.7.1.8 Ejemplo 8\nTasas de riesgo (Tablas de vida en USA) expresadas por día calendario:\n\nlibrary(survival)\n\n\nAttaching package: 'survival'\n\n\nThe following object is masked _by_ '.GlobalEnv':\n\n    kidney\n\ndim(survexp.us)\n\n[1] 110   2  75\n\nhazMale <- survexp.us[,\"male\",\"2010\"]\nhazFemale <- survexp.us[,\"female\",\"2010\"]\ntm <- 1:110\ntm.diff <- c(1,diff(tm))\nsurvMale <- exp(-cumsum(hazMale*tm.diff)*365.24)\nsurvFemale <- exp(-cumsum(hazFemale *tm.diff)*365.24)\ndata.tot <- data.frame(tm,hMale = as.numeric(hazMale),\n                       hFemale = as.numeric(hazFemale),\n                       sMale = survMale, sFemale = survFemale)\ndata.tot.long <- pivot_longer(data.tot,cols = hMale:sFemale)\n\nGrafico de tasas de riesgo:\n\ndata.tot.long.h <- data.tot.long %>% filter(name == 'hMale' | name == 'hFemale')\nggplot(data = data.tot.long.h)+geom_line(mapping = aes(x = tm,y = value,col = name)) + theme_bw() + xlab('Age')+ylab('Hazard')\n\n\n\n\nGrafico de probabilidades de sobrevivencia:\n\ndata.tot.long.s <- data.tot.long %>% filter(name == 'sMale' | name == 'sFemale')\nggplot(data = data.tot.long.s)+geom_line(mapping = aes(x = tm,y = value,col = name)) + theme_bw() + xlab('Age')+ylab('Hazard')\n\n\n\n\n\n\n\n\nKlein, John P., and Melvin L. Moeschberger. 2003. Survival analysis : techniques for censored and truncated data. Springer."
  },
  {
    "objectID": "estNP.html#intervalos-de-confianza-puntuales-de-st",
    "href": "estNP.html#intervalos-de-confianza-puntuales-de-st",
    "title": "2  Estimación No-Paramétrica",
    "section": "2.1 Intervalos de confianza puntuales de \\(S(t)\\)",
    "text": "2.1 Intervalos de confianza puntuales de \\(S(t)\\)\nSea \\(\\sigma_S(t)^2=\\frac{\\hat V[\\hat S(t)]}{\\hat S(t)^2}\\). Si \\(t_0\\) es un punto fijo de tiempo, definimos el intervalo de confianza lineal al \\(100\\cdot (1-\\alpha)\\)% para \\(S(t_0)\\) como:\n\\[\\hat S(t_0)\\pm z_{1-\\alpha/2}\\sigma_S(t_0)\\hat S(t_0)\\]\nCon el fin de mejorar el intervalo de confianza anterior, se puede considerar un intervalo de confianza sobre el logaritmo de \\(H(t)\\):\n\\[\\log \\hat H(t_0)\\pm z_{1-\\alpha/2}\\cdot \\sigma^*(t_0)\\]\ndonde \\(\\sigma^*(t_0)\\) lo tenemos que calcular o bien aproximar. Como \\(\\text{Var}(\\hat S(t))\\approx \\hat S(t)^2\\sigma_S(t)^2\\) entonces por el método delta (Ejercicio):\n\\[\\begin{align*}\n   \\text{Var}[\\log H(t_0)]&=\\text{Var}[\\log(-\\log S(t_0))]\\\\\n   &\\approx \\frac{1}{[\\log \\hat S(t_0)]^2}\\underbrace{\\sum_{t_i\\leq t}\\frac{d_i}{Y_i(Y_i-d_i)}}_{\\sigma_S(t_0)^2}\n\\end{align*}\\]\nentonces podemos aproximar el término \\(\\sigma^*(t_0)\\) y obtener:\n\\[\\log \\hat H(t_0)\\pm z_{1-\\alpha/2}\\cdot \\frac{1}{\\log S(t_0)}\\sigma_S(t_0)\\]\nes un intervalo de confianza al \\(100(1-\\alpha)\\)’% para \\(\\log[-\\log S(t_0)]\\). Entonces:\n\\[\\hat H(t_0)\\exp\\left[\\pm\\frac{z_{1-\\alpha/2}\\sigma_S(t_0)}{\\log S(t_0)}\\right]\\]\nes un IC para \\(H(t_0)\\) y \\([\\hat S(t_0)^{1/\\theta},\\hat S(t_0)^\\theta]\\) donde \\(\\theta=\\exp\\left[\\frac{z_{1-\\alpha/2}\\sigma_S(t_0)}{\\log \\hat S(t_0)}\\right]\\) es el IC al \\(100(1-\\alpha)\\)% para \\(S(t_0)\\).\nOtra posibilidad es utilizar la transformación \\(\\text{arcsen}[\\hat S(t_0)^{1/2}]\\)\nVentaja: ambas posibilidades permiten que el IC de \\(S(t_0)\\) no salga del intervalo \\([0,1]\\).\nPor otro lado, para muestras pequeñas, el IC con la transformación arcsen es más conservador, seguido del IC con transformación log-log y de último el lineal (sin transformación).\nNota: los intervalos log-log y arcsen no son simétricos."
  },
  {
    "objectID": "estNP.html#bandas-de-confianza-para-st",
    "href": "estNP.html#bandas-de-confianza-para-st",
    "title": "2  Estimación No-Paramétrica",
    "section": "2.2 Bandas de confianza para \\(S(t)\\)",
    "text": "2.2 Bandas de confianza para \\(S(t)\\)\nQueremos encontrar dos funciones aleatorias \\(L(t)\\) y \\(U(t)\\) tal que:\n\\[P[L(t)\\leq S(t)\\leq U(t)\\quad \\forall t: t_L\\leq t\\leq t_U]=1-\\alpha\\]\nA \\([L(t),U(t)]\\) le llamamos banda de confianza al \\(100(1-\\alpha)\\)% para \\(S(t)\\).\nNair(1984) define el concepto de Bandas EP, las cuales son proporcionales a los intervalos puntuales. Sean \\(t_L<t_U\\) tal que \\(t_L\\geq \\text{tiempo más pequeño del evento observado}\\) y \\(t_U\\leq \\text{tiempo más grande del evento observado}\\). Si \\(n\\) es el tamaño de muestra, defina:\n\\[a_L=\\frac{n\\sigma_S(t_L)^2}{1+n\\sigma_S(t_L)^2},\\qquad a_U=\\frac{n\\sigma_S(t_U)^2}{1+n\\sigma_S(t_U)^2}\\]\ny tomando \\(c_\\alpha(a_L,a_U)\\) de la tabla C.3 del Klein (también se puede obtener de R) entonces los tres tipos de Banda de confianza al \\(100(1-\\alpha)\\)% son:\n\nLineal: \\(\\hat S(t)\\pm c_\\alpha(a_L,a_U)\\sigma_S(t)\\hat S(t)\\)\nLog-log; \\((\\hat S(t)^{1/\\theta},\\hat S(t)^\\theta)\\), donde \\(\\theta=\\exp\\left[\\frac{c_\\alpha(a_L,a_U)\\sigma_S(t)}{\\log[\\hat S(t)]}\\right]\\).\nArcsen-raíz cuadrada: ver fórmula 4.4.4 del Klein.\n\nOtro método para construir las bandas es el de Hall y Wellner (1980) (ver Klein).\nNotas:\n\nSe pueden construir bandas de confianza para la tasa de riesgo acumulativo.\nIgual que en el caso de los intervalos puntuales, los intervalos log-log y arcsen se comportan mejor bajo muestras pequeñas."
  },
  {
    "objectID": "estNP.html#estimación-del-tiempo-medio-y-mediano-de-sobrevivencia",
    "href": "estNP.html#estimación-del-tiempo-medio-y-mediano-de-sobrevivencia",
    "title": "2  Estimación No-Paramétrica",
    "section": "2.3 Estimación del tiempo medio y mediano de sobrevivencia",
    "text": "2.3 Estimación del tiempo medio y mediano de sobrevivencia\nRecuerden que el tiempo medio de sobrevivencia es:\n\\[\\mu=\\int_0^\\infty S(t)dt\\]\nUn estimador plug-in para este caso es:\n\\[\\hat \\mu=\\int_0^\\infty\\hat S(t)dt\\]\ncon el principal inconveniente de que el estimador de Kaplan-Meier está definido hasta un valor de \\(t\\) máximo, llámese \\(\\tau\\) (tiempo de sobrevivencia máximo condicionado con respecto a censuras):\n\\[\\hat \\mu_\\tau=\\int_0^\\tau \\hat S(t)dt\\]\nNormalmente \\(\\tau\\) es el tiempo de muerte máximo o bien el tiempo máximo de censura asumiendo muerte del individuo (corrección de Efron). Para el estimador \\(\\mu_\\tau\\), su varianza es:\n\\[\\hat V[\\hat \\mu_\\tau]=\\sum_{i=1}^D\\left[\\int_{t_i}^\\tau \\hat S(t)dt\\right]^2\\frac{d_i}{Y_i(Y_i-d_i)}\\]\ny un intervalo de confianza para \\(\\mu\\) al \\(100(1-\\alpha)\\)% es:\n\\[\\hat \\mu_\\tau\\pm z_{1-\\alpha/2}\\sqrt{\\hat V[\\hat \\mu_\\tau]}\\]\nPor otro lado, también es posible estimar cuantiles de la distribución de \\(T\\):\n\\[\\text{cuantil-}p = x_p = \\inf\\{t:S(t)\\leq 1-p\\}\\]\nel cual puede ser estimado con un estimador plug-in:\n\\[\\hat x_p = \\inf\\{t:\\hat S(t)\\leq 1-p\\}\\]\nLa varianza del estimador anterior se pueden estimar como:\n\\[\\hat V(\\hat x_p)=\\frac{\\hat V[\\hat S(x_p)]}{\\hat f(\\hat x_p)^2}\\]\ndonde \\(\\hat f(\\hat x_p)\\) es un estimador no-paramétrico de \\(f(\\hat x_p)\\) (densidad). Por ejemplo, cualquier estimador por kernel de \\(f\\) es una opción válida.\nAproximación de Brookmeyer y Crowley\n\\[-z_{1-\\alpha/2}\\leq \\frac{\\hat S(t)-(1-p)}{\\hat V^{1/2}[\\hat S(t)]}\\leq z_{1-\\alpha/2}\\]\nes un intervalo de confianza al \\(100(1-\\alpha)\\)% para \\(x_p\\). Un IC para \\(x_p\\) basado en la transformación log-log es:\n\\[-z_{1-\\alpha/2}\\leq \\frac{\\log(-\\log \\hat S(t))-\\log(-\\log(1-p))}{\\frac{\\hat V^{1/2}(\\hat S(t))}{\\hat S(t)\\log \\hat S(t)}}\\leq z_{1-\\alpha/2}\\]\nNota: caso más usual es \\(p=1/2\\)."
  },
  {
    "objectID": "estNP.html#estimadores-para-datos-censurados-por-la-derecha-y-truncados-por-la-izquierda",
    "href": "estNP.html#estimadores-para-datos-censurados-por-la-derecha-y-truncados-por-la-izquierda",
    "title": "2  Estimación No-Paramétrica",
    "section": "2.4 Estimadores para datos censurados por la derecha y truncados por la izquierda",
    "text": "2.4 Estimadores para datos censurados por la derecha y truncados por la izquierda\nConsidere para cada individuo:\n\n\\(L_j\\): edad aleatoria de ingreso del individuo \\(j\\)-ésimo.\n\\(T_j\\): tiempo de ocurrencia del evento o censura para el individuo \\(j\\)-ésimo.\n\nSea \\(t_1<t_2<\\cdots <t_D\\) los tiempos distintos de ocurrencia de los eventos. Además, siguiendo la notación de las secciones anteriores:\n\n\\(d_i\\): número de individuos que experimentan el evento o riesgo de interés en tiempo \\(t_i\\) (\\(i=1,\\ldots,D\\))\n\\(Y_i\\): individuos en riesgo al tiempo \\(t_i\\).\n\nCon el fin de considerar esquemas de censura/truncamiento más amplios, se tienen las siguientes dos definiciones para la población en riesgo:\n\n\\(Y_i\\): número de individuos en el estudio en tiempo \\(0\\) y que están en riesgo al momento \\(t_i\\) (esquema sin truncamiento )\n\\(Y_i\\): número de individuos en riesgo al momento \\(t_i\\) tales que (Truncamiento por la izquierda):\n\n\\[L_j<t_i \\leq T_j\\]\nTodos los estimadores de \\(S(t)\\) vistos hasta ahora aplican, pero la interpretación debe hacerse con cuidado. Por ejemplo, el estimador de KM se debe interpretar como el estimador de la función de sobrevivencia en tiempo \\(t\\), pero condicional en \\(L=\\min_j\\{L_j\\}\\):\n\\[P[X>t|X\\geq L]=\\frac{S(t)}{S(L)}\\]\nPor lo tanto el estimador de KM sería:\n\\[\\hat S_L(t)=\\prod_{L\\leq t_i \\leq t}\\left[1-\\frac{d_i}{Y_i}\\right]\\qquad t\\geq L\\]\nes decir se estaía incluyendo solamente eventos o censuras que estén después de \\(a\\), donde \\(a=L\\).\nNota: las fórmulas de Nelson-Aalen y Greenwood también se pueden calcular en este contexto."
  },
  {
    "objectID": "estNP.html#estimadores-para-riesgos-en-competencia",
    "href": "estNP.html#estimadores-para-riesgos-en-competencia",
    "title": "2  Estimación No-Paramétrica",
    "section": "2.5 Estimadores para riesgos en competencia",
    "text": "2.5 Estimadores para riesgos en competencia\nPara modelos de riesgos de competencia, el supuesto de independencia entre tiempos de eventos y censuras no necesariamente se puede aplicar. En este caso, definimos tres formas distintas de resumir información:\nEstimador de Kaplan-Meier complementario\nSi existieran dos riesgos en competencia (A y B) se define el estimador:\n\\[\\hat S_A(t)=KM(\\text{ocurrencias de A como eventos, ocurrencias de B como censuras})\\]\nLa idea se generaliza muy fácilmente para el caso de más de dos riesgos. Inconveniente: estimador muy crudo para generar interpretaciones apropiadas.\nFunción acumulada de incidencia\nSea \\(t_1,\\ldots,t_k\\) los tiempos distintos en los cuales uno de los riesgos en competencia ocurre. En tiempo \\(t_i\\) definimos lo siguiente:\n\n\\(Y_i\\): número de sujetos en riesgo al momento \\(t_i\\).\n\\(r_i\\): número de sujetos que les ocurrió el evento de interés.\n\\(d_i\\): número de sujetos que les ocurrió otro evento que no sea el de interés (sin incluir censuras).\n\nLa función acumulada de incidencia se define:\n\\[\\begin{align*}\n   CI(t)=\\begin{cases}\n     0 & t\\leq t_1\\\\\n     \\sum_{t_i\\leq t}\\underbrace{\\left[\\prod_{j=1}^{i-1}\\frac{1-(d_j+r_j)}{Y_j}\\right]}_{\\hat S(t_{i-})}\\frac{r_i}{Y_i} & t_1\\leq t\n  \\end{cases}\n\\end{align*}\\]\ndonde \\(\\hat S(t_{i-})\\) es el estimador KM evaluado justo antes de \\(t_i\\).\nInterpretación de \\(CI(t)\\): probabilidad de que el evento de interés ocurra antes de tiempo \\(t\\) y antes de cualquier otro evento en competencia. La varianza de \\(CI(t)\\) es: (fórmula 4.7.2-Klein)\n\\[V[CI(t)]=\\sum_{t_i\\leq t}\\hat S(t_i)^2\\left[(CI(t)-CI(t_i))^2\\cdot \\frac{r_i+d_i}{Y_i^2}+[1-2(CI(t)-CI(t_i))]\\cdot \\frac{r_i}{Y_i^2}\\right]\\]\nde lo anterior es posible construir un intervalo de confianza al \\(100(1-\\alpha)\\)% para la incidencia acumulada:\n\\[CI(t)\\pm z_{1-\\alpha/2}V[CI(t)]^{1/2}\\]\nProbabilidad condicional para un riesgo en competencia\nSi \\(CI_k(t)\\) es la función acumulada de incidencia para el riesgo \\(k\\)-ésimo y \\(CI_{k^c}(t)\\) es la función acumulada de incidencia para todos los riesgos excepto el \\(k\\)-ésimo. Entonces definimos la probabilidad condicional para el riesgo \\(k\\)-ésimo como:\n\\[CP_k(t)=\\frac{CI_k(t)}{1-CI_{k^c}(t)}\\]\ncon varianza:\n\\[V[CP_k(t)]=\\frac{\\hat S(t_{-})^2}{[1-CI_{k^c}(t)]^4}\\sum_{t_i\\leq t}\\frac{[1-CI_{k^c}(t_i)]^2r_i+CI_k(t_i)^2d_i}{Y_i^2}\\]\nInterpretación de \\(CP_k(t)\\): estima la probabilidad condicional de que el evento \\(k\\) ocurre en tiempo \\(t\\) si ninguna de las otras causas de riesgo han ocurrido antes de \\(t\\)."
  },
  {
    "objectID": "estNP.html#estimación-de-st-para-otros-esquemas-de-censura",
    "href": "estNP.html#estimación-de-st-para-otros-esquemas-de-censura",
    "title": "2  Estimación No-Paramétrica",
    "section": "2.6 Estimación de \\(S(t)\\) para otros esquemas de censura",
    "text": "2.6 Estimación de \\(S(t)\\) para otros esquemas de censura\n\n2.6.1 Censura por la izquierda\nEn este caso los individuos experimentan el evento antes del periodo de observación, o bien lo experimentan dentro del periodo de observacion.\nSolución: redefinir el tiempo al fijar para \\(\\tau>0\\) (grande):\n\\[\\tilde t=\\tau-t\\]\ny transformar entonces la censura por la izquierda por censura por la derecha. Como estimadores se pueden utilizar KM o Nelson-Aalen con la particularidad de que:\n\\[P[\\tau-X>t]=P[X<t-\\tau]\\]\n\n\n2.6.2 Censura doble\nPara estimar \\(S(t)\\) bajo este esquema, usaremos el Proceso o algoritmo de Turnbull:\nSuponga una grilla de puntos en el tiempo:\n\\[0=t_0<t_1<t_2<\\cdots<t_m\\]\ny defina:\n\n\\(d_i\\): número de eventos en tiempo \\(t_i\\) (\\(d_i\\) puede ser 0).\n\\(r_i\\): número de individuos con censura por la derecha en tiempo \\(t_i\\).\n\\(c_i\\): número de individuos con censura por la izquierda en tiempo \\(t_i\\).\n\nAlgoritmo\n\nPaso 0: Produzca un estimador inicial de \\(S(t)\\) en cada \\(t_j\\) llamado \\(S_0(t_j)\\). Turnbull (1974): tome \\(S_0(t)=KM(t)\\) ignorando la censura por la izquierda.\nPaso \\(k+1\\):\n\nCon \\(S_k(\\cdot)\\) calcule, para \\(j\\leq i\\):\n\n\n\\[p_{ij}=P[t_{j-1}<X\\leq t_i|X\\leq t_i]=\\frac{S_k(t_{j-1})-S_k(t_j)}{1-S_k(t_i)}\\]\n\nEstime el número de eventos en tiempo \\(t_i\\) como:\n\n\\[\\hat d_i=d_i+\\sum_{i=j}^m c_ip_{ij}\\]\n\nCalcule el estimador KM con datos censurados por la derecha usando \\(\\hat d_i\\) como eventos y \\(r_i\\) como censuras.\nSi \\(S_{k+1}(t)\\) es cercano a \\(S_k(t)\\) para todo \\(t_i\\) entonces el proceso termina.\n\n\n\n2.6.3 Censura por intervalo\nPara este esquema cada individuo tiene un intervalo \\((L_i,R_i]\\) en donde el evento ocurre, pero el tiempo exacto es desconocido (\\(i=1,\\ldots,n\\))\nPara estimar la función de sobrevivencia, se utiliza una modificación del algoritmo de Turnbull. Considere una grilla de tiempos \\(0=\\tau_0<\\tau_1<\\cdots<\\tau_m\\) que incluyen a \\(L_i,R_i\\) para todo \\(i=1,\\ldots,n\\).\nPara la observación \\(i\\)-ésima, defina:\n\\[\\begin{align*}\n\\alpha_{ij}=\n   \\begin{cases}\n       1 & \\text{si } (\\tau_{j-1},\\tau_j]\\subseteq (L_i,R_i] \\\\\n       0 & \\text{otro caso}\n   \\end{cases}\n\\end{align*}\\]\ny dado un estimador inicial de \\(S(\\tau_j)\\):\n\nPaso 1: Calcule la probabilidad de que el evento ocurre en tiempo \\(\\tau_j\\):\n\n\\[p_j=S(\\tau_{j-1})-S(\\tau_j) \\qquad j=1,\\ldots,m\\]\n\nPaso 2: Estime el número de eventos al tiempo \\(\\tau_i\\):\n\n\\[d_i=\\sum_{i=1}^n \\frac{\\alpha_{ij}p_j}{\\sum_k \\alpha_{ik}p_k}\\]\n\nPaso 3: Calcule una estimación de los sujetos en riesgo al tiempo \\(\\tau_i\\):\n\n\\[Y_i=\\sum_{k=i}^m d_k\\]\n\nPaso 4: Calcule el estimador KM con los datos en los pasos 3 y 4 hasta que haya convergencia de \\(S\\) uniformemente en \\(\\tau_i\\)."
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "Referencias",
    "section": "",
    "text": "Klein, John P., and Melvin L. Moeschberger. 2003. Survival analysis : techniques for censored and truncated\ndata. Springer."
  }
]