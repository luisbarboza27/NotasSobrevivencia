[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Análisis de Sobrevivencia",
    "section": "",
    "text": "Introducción\nEstas notas de clase corresponden al material teórico y pŕactico del curso Análisis de Sobrevivencia (Modelos de Vida) (CA0503) durante el I-2023."
  },
  {
    "objectID": "Preliminares.html#características-de-x",
    "href": "Preliminares.html#características-de-x",
    "title": "1  Preliminares",
    "section": "1.1 Características de \\(X\\):",
    "text": "1.1 Características de \\(X\\):\nA continuación explicamos cada característica:\n\n1.1.1 Función de Sobrevivencia\n\nDefinition 1.1 (Función de sobrevivencia) \\[S(x)=P(X>x)\\]\n\nEn un contexto de tiempo de vida de aparatos o máquinas, a la función \\(S(x)\\) también se le llama función de utilidad o fiabilidad.\nNote que si \\(X\\) es una variable aleatoria continua entonces \\(S(x)\\) es una función monótona decreciente. Además, si \\(f\\) es la función de densidad de \\(X\\):\n\\[S(x)=1-F(x)=\\int_x^{\\infty} f(t)dt\\] y por lo tanto: \\[f(x)=-\\frac{dS(x)}{dx}\\]\n\n\n\n\n\n\nEjemplo: Distribución Weibull\n\n\n\nEn este caso \\(S(x)=\\exp(-\\lambda x^{\\alpha})\\), para \\(\\lambda>0\\) y \\(\\alpha>0\\).\nNote que si \\(\\alpha=1\\) entonces \\(X\\sim \\text{Exponencial}(\\lambda)\\).\n\n\nA continuación se ilustra \\(S(x)\\) cuando \\(\\lambda=\\alpha=2\\):\n\nSWeibull <- function(x,lambda,alpha){\n  exp(-lambda*x^(alpha))\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = SWeibull,args= list(lambda = 2, alpha = 2))+\n  ylab('S')+\n  theme_bw()\n\n\n\n\nEn términos generales \\(S(0)=1\\) y \\(S(\\infty)=0\\), para cualquier función de sobrevivencia \\(S\\). Además, es importante recalcar que una tabla de vida o una tabla de decrementos en general es un estimador de \\(S\\) bajo un cierto conjunto de datos observados.\nNote que en el caso discreto: \\[S(x)=\\sum_{x_j>x}p(x_j)\\]\ndonde \\(p(x_j)\\) es la función de masa evaluada en \\(x_j\\).\n\n\n1.1.2 Función o Tasa de Riesgo\nEsta función se conoce en otros contextos con otros nombres:\n\nTasa de fallo condicional (aparatos electrónicos, ingeniería)\nFuerza de mortalidad (demografía)\nTasa de fallo específica por edad (epidemiología)\nHazard (en inglés)\n\n\nDefinition 1.2 (Función de riesgo) \\[h(x)=\\lim_{\\Delta x\\rightarrow 0}\\frac{P[x\\leq X < x+\\Delta x|X\\geq x]}{\\Delta x}\\]\n\nEn el caso en que \\(X\\) es una variable aleatoria continua: \\[\\begin{align*}\nh(x)&=\\lim_{\\Delta x\\rightarrow 0}\\frac{F(x+\\Delta x)-F(x)}{\\Delta x}\\cdot \\frac{1}{S(x)}\\\\\n&=\\frac{f(x)}{S(x)}=-\\frac{d}{dx}\\log (S(x))\n\\end{align*}\\]\nSi la función de riesgo se acumula en el intervalo \\([0,x]\\), se obtiene la función de riesgo acumulativo: \\[\\begin{align*}\nH(x)=\\int_0^xh(u)du&=-\\int_0^x \\frac{d}{du}\\log(S(u))du\\\\\n&=-\\log(S(x)).\n\\end{align*}\\]\nEntonces: \\[\nS(x)=\\exp[-H(x)]=\\exp\\left[-\\int_0^th(u)du\\right]\n\\tag{1.1}\\]\nen donde a la expresión \\(h(u)du\\) dentro de la integral se le llama probabilidad instantánea del riesgo.\nLa función de riesgo \\(h(x)\\) necesita ser solamente positiva para asegurar de que la función de sobrevivencia esté bien definida. Por lo tanto no hay muchas restricciones en la forma que tiene la función de riesgo en \\((0,\\infty)\\). Por ejemplo la función de riesgo es monótona creciente en la mayoría de situaciones en donde hay desgaste en las condiciones de existencia en seres o aparatos. También puede ser monótona decreciente en situaciones en donde el riesgo del evento disminuye conforme pasa el tiempo, por ejemplo en el caso de la mortalidad infantil. También se puede tener funciones de riesgo combinadas al tener episodios de riesgo creciente y después de un evento el riesgo disminuye hasta un cierto valor, por ejemplo cuando un paciente es intervenido en un momento de riesgo máximo y después se recupera disminuyendo su riesgo hasta un valor esperable.\n\n\n\n\n\n\nEjemplo: Distribución Weibull\n\n\n\nEn este caso la función de densidad es: \\[f(x)=-\\frac{dS(x)}{dx}=\\lambda \\alpha x^{\\alpha-1}\\exp(-\\lambda x^{\\alpha})\\] entonces: \\[h(x)= \\lambda \\alpha x^{\\alpha-1}\\] Note que si \\(\\alpha=1\\) entonces \\(h(x)=h\\alpha\\), si \\(\\alpha>1\\) la función de riesgo es creciente y si \\(\\alpha<1\\) es decreciente.\n\n\nEn el caso en que \\(\\alpha=\\lambda=2\\)\n\nhWeibull <- function(x,lambda,alpha){\n  lambda*alpha*x^(alpha-1)\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = hWeibull,args= list(lambda = 2, alpha = 2))+\n  ylab('h')+\n  theme_bw()\n\n\n\n\nPara otro caso, ver ejemplo 2.2 del (Klein and Moeschberger 2003).\nEn el caso en que \\(X\\) es una variable aleatoria discreta: \\[h(x_j)=P[X=x_j|X\\geq x_j]=\\frac{p(x_j)}{S(x_{j-1})}\\] para \\(j=1,2,\\ldots\\) y donde \\(S(x_0)=1\\). Como \\(p(x_j)=S(x_{j-1})-S(x_j)\\) entonces: \\[h(x_j)=1-\\frac{S(x_j)}{S(x_{j-1})}\\]\nAdemás: \\[\\begin{align*}\nS(x)&=\\prod_{x_j\\leq x}\\frac{S(x_j)}{S(x_{j-1})}\\\\\n&=\\prod_{x_j\\leq x}[1-h(x_j)]\n\\end{align*}\\]\n\n\n\n\n\n\nEjemplo: Distribución Discreta\n\n\n\nSi \\(p(x_j)=\\frac 1 3\\) para \\(j=1,2,3\\) entonces: \\[S(x)=P(X>x)=\n  \\begin{cases}\n  1 & 0\\leq x <1\\\\\n  2/3 & 1\\leq x <2 \\\\\n  1/3 & 2\\leq x <3 \\\\\n  0 & x\\geq 3\n  \\end{cases}\n\\]\ny \\[h(x)=\n    \\begin{cases}\n  1/3 & j=1 \\\\\n  1/2 & j=2 \\\\\n  1 & j=3\n    \\end{cases}\n  \\]\n\n\nEn términos generales la función de riesgo es más informativa que la función de sobrevivencia.\nSiguiendo con el caso discreto: \\[H(x)=\\sum_{x_j\\leq x}h(x_j)\\] y la relación Equation 1.1 no aplica. Otros autores prefieren definir la función de riesgo acumulada: \\[H(x)=-\\sum_{x_j\\leq x}\\log(1-h(x_j))\\] y en este caso la relación exponencial entre \\(S(x)\\) y \\(H(x)\\) sí se preserva. Note que si \\(h(x_j)\\approx 0\\) entonces la definición anterior de \\(H(x)\\) es una aproximación de Taylor de la definición original.\n\n\n1.1.3 Vida Residual Media\nEn muchas aplicaciones se requiere una estimación del tiempo esperado en que el evento va a ocurrir, dadas las condiciones actuales:\n\nDefinition 1.3 (Vida Residual Media) \\[\\begin{align*}\n    mrl(x)&=E[X-x|X>x]=\\frac{\\int_x^{\\infty}(t-x)f(t)dt}{S(x)}\\\\\n    &=\\frac{\\int_x^{\\infty}S(t)dt}{S(x)}\n\\end{align*}\\]\n\nCuando \\(x=0\\), entonces \\(mrl(0)=\\int_0^{\\infty}S(t)dt=EX\\). Por otro lado se puede comprobar (Ejercicio): \\[\\begin{align*}\n    \\text{Var}(X)=2\\int_0^{\\infty}tS(t)dt-\\left[\\int_0^{\\infty}S(t)dt\\right]^2\n\\end{align*}\\]\nAdemás a partir de la función de sobrevivencia, también se puede calcular el cuantil correspondiente:\n\nDefinition 1.4 (Cuantil-p) Mínimo \\(x_p\\) tal que \\(S(x_p)\\leq 1-p\\): \\[\\inf\\{t:S(t)\\leq 1-p\\}\\] En el caso continuo: \\(S(x_p)=1-p\\).\n\n\n\n\n\n\n\nEjemplo: Ejemplos de vida media\n\n\n\nExponencial: Vida media \\(\\mu=EX=\\frac 1 \\lambda\\). Vida mediana \\(S(x_{0.5})=0.5\\), entonces:\n\\[S(x_{0.5})=e^{-\\lambda x_{0.5}}=\\frac 1 2 \\Rightarrow x_{0.5}=\\frac{\\log 2}{\\lambda}\\]\nVida media residual (usando la propiedad de pérdida de memoria): \\[mrl(x)=E[X-x|X>x]=E[X]=\\frac 1 \\lambda\\]\nWeibull:: \\[1-p=\\exp(-\\lambda x^{\\alpha}_p)\\Rightarrow x_p=\\left[-\\frac{\\log(1-p)}{\\lambda}\\right]^{1/\\alpha}\\]\n\n\nEn el ejemplo desarrollado anteriormente, en donde \\(\\alpha=\\lambda=2\\):\n\nalpha <- lambda <- 2\nx_05 <- (-log(1-0.5)/lambda)^(1/alpha)\nshow(x_05)\n\n[1] 0.588705\n\n\nes la vida mediana bajo el supuesto Weibull.\nEn el caso discreto: \\[mrl(x)=\\frac{(x_{i+1}-x)S(x_i)+\\sum_{j\\geq i+1}(x_{j+1}-x_j)S(x_j)}{S(x)}\\qquad \\text{para }x_i\\leq x<x_{i+1}\\]"
  },
  {
    "objectID": "Preliminares.html#modelos-paraméricos-usuales",
    "href": "Preliminares.html#modelos-paraméricos-usuales",
    "title": "1  Preliminares",
    "section": "1.2 Modelos Paraméricos Usuales",
    "text": "1.2 Modelos Paraméricos Usuales\nAdemás del caso Weibull, existen otras escogencias para modelar la función de sobrevivencia. Las más usuales son:\n\n1.2.1 Exponencial\n\\[\\begin{align*}\n    S(x)&=e^{-\\lambda x}, \\qquad x>0, \\lambda>0\\\\\n    f(x)&=\\lambda e^{-\\lambda x}\\\\\n    h(x)&=\\lambda\n\\end{align*}\\] Recuerden además que en el caso exponencial se cumple la propiedad de pérdida de memoria: \\(P(X\\geq x+z|X\\geq x)=P(X\\geq z)\\).\n\n\n1.2.2 Weibull\n\\[\\begin{align*}\n    S(x)&=e^{-\\lambda x^\\alpha}, \\qquad x>0, \\lambda>0, \\alpha>0\\\\\n    h(x)&=\\lambda\\alpha x^{\\alpha-1}\n\\end{align*}\\] a los parámetros \\(\\lambda\\) y \\(\\alpha\\) se les llama de escala y forma respectivamente.\nBajo la transformación \\(Y=\\log X\\) si \\(X\\sim Weibull\\) se puede escribir \\(Y=\\mu+\\sigma E\\) donde \\(\\mu=\\frac{-\\log \\lambda}{\\alpha}\\) y \\(\\sigma=\\frac 1 \\alpha\\) y \\(E\\sim\\) Valor Extremo Estándar, es decir: \\[f_e(w)=e^{w-e^w}, \\quad w\\in  \\mathbb R\\] y \\[S_E(w)=e^{-e^w}\\]\n\n\n1.2.3 Log-normal\n\\(X\\) es una LogNormal\\((\\mu,\\sigma^2)\\) si \\(Y=\\log X\\sim N(\\mu,\\sigma^2)\\). En este caso: \\[\\begin{align*}\n    S(x)&=1-\\Phi\\left(\\frac{\\log x-\\mu}{\\sigma}\\right)\\\\\n    h(x)&=\\frac{\\phi(x)}{S(x)}\n\\end{align*}\\] En general la tasa de riesgo \\(h(x)\\) no es monótona, por ejemplo tomando \\(\\mu=0\\) y \\(\\sigma=1\\):\n\nhLNormal <- function(x,mu,sigma){\n  dnorm(x)/plnorm(x,meanlog = mu,sdlog = sigma,lower.tail = F)\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = hLNormal,args= list(mu = 0, sigma = 1))+\n  ylab('h')+\n  theme_bw()\n\n\n\n\nlo cual no necesariamente tiene sentido en muchas aplicaciones.\n\n\n1.2.4 Log-logístico\n\\(X\\) es una variable aleatoria log-logística si \\(Y=\\log X\\sim\\) logístico: \\[f_Y(y)=\\frac{e^{\\frac{y-\\mu}{\\sigma}}}{\\sigma\\left[1+e^{\\frac{y-\\mu}{\\sigma}}\\right]^2},\\qquad y \\in \\mathbb R\\]\ncon función de tasa y función de sobrevivencia: \\[\\begin{align*}\n    h(x)&=\\frac{\\alpha \\lambda x^{\\alpha-1}}{1+\\lambda x^\\alpha}\\qquad \\text{más flexible que Weibull}\\\\\n    S(x)&=\\frac{1}{1+\\lambda x^\\alpha}\n\\end{align*}\\] con \\(\\alpha=\\frac 1 \\sigma>0\\), \\(\\lambda=e^{-\\mu/\\sigma}\\)\n\n\n1.2.5 Gamma\n\\[f(x)=\\frac{\\lambda^\\beta x^{\\beta-1}e^{-\\lambda x}}{\\Gamma(\\beta)},\\qquad \\lambda,\\beta,x>0\\] Si \\(\\beta=1\\): exponencial, \\(\\beta\\longrightarrow \\infty\\): Normal. Además \\(h(x)\\) tiene una forma complicada (ver Klein) pero no es muy flexible (solamente crece o decrece).\n\n\n1.2.6 Gompertz\n\\[\\begin{align*}\n    f(x)&=\\theta \\exp(\\alpha x)\\exp \\left(\\frac \\theta \\alpha (1-e^{\\alpha x})\\right)\\\\\n    h(x)&=\\theta \\exp(\\alpha x)                                                                                                               \n\\end{align*}\\] en este caso si \\(\\alpha>1\\) y \\(\\theta>0\\) entonces \\(h\\) es monótona creciente. Además podemos generalizar levemente la ley anterior por medio del modelo de Makeham: \\[h(x)=\\theta \\exp(\\alpha x)+\\lambda\\]\nla cual permite que \\(h\\) sea más flexible.\n\nhGompertz <- function(x,alpha,theta,lambda){\n  theta*exp(alpha*x)+lambda\n}\n\nggplot()+\n  xlim(0,3)+\n  geom_function(fun = hGompertz,args= list(alpha = 0.5, theta = 0.5,lambda = 0.2))+\n  ylab('h')+\n  theme_bw()"
  },
  {
    "objectID": "Preliminares.html#modelos-de-regresión-para-datos-de-sobrevivencia",
    "href": "Preliminares.html#modelos-de-regresión-para-datos-de-sobrevivencia",
    "title": "1  Preliminares",
    "section": "1.3 Modelos de regresión para datos de sobrevivencia",
    "text": "1.3 Modelos de regresión para datos de sobrevivencia\nSea \\(X\\) la variable aleatoria de tiempo de fallo u ocurrencia de riesgo. Usualmente la distribución de la variable \\(X\\) se asocia con variables explicativas o covariables:\n\\[Z^T=(Z_1,\\ldots,Z_p)\\]\ndonde estas covariables pueden ser cuantitativas o categóricas, y no se descarta la posibilidad de que estas dependan del tiempo \\(x\\):\n\\[Z^T(x)=(Z_1(x),\\ldots,Z_p(x))\\]\nUsualmente los modelos de regresión en este contexto se definen de dos formas:\nEnfoque 1\nUsar la variable dependiente \\(X\\) como variable transformada según \\(Y=\\log(X)\\) y hacer la regresión lineal múltiple:\n\\[Y=\\mu+\\gamma^TZ+\\sigma \\epsilon\\]\ndonde \\(\\gamma^T=(\\gamma_1,\\ldots,\\gamma_p)\\) es un vector de coeficientes y \\(\\epsilon\\) es un error independiente que se puede distribuir según:\n\nUna normal estándar (Regresión log-normal).\nUna distribución de valor extremo estándar (Regresión Weibull)\nUna distribución logística (Regresión log-logística).\n\nMétodo de estimación: Máxima Verosimilitud.\nSea \\(S_0(x)\\) la función de sobrevivencia de \\(X=e^Y\\) cuando \\(Z=0\\), es decir es la función de sobrevivencia de \\(\\exp(\\mu+\\sigma \\epsilon)\\). Entonces:\n\\[\\begin{align*}\n    P[X>x|Z]&=P[Y>\\log x|Z]=P[\\mu+\\gamma^TZ+\\sigma \\epsilon>\\log x|Z]\\\\\n    &=P[\\exp(\\mu+\\sigma \\epsilon)>x\\exp(-\\gamma^T Z)|Z]=S_0(x\\exp(-\\gamma^T Z)).\n\\end{align*}\\]\nConclusión: el efecto de las covariables \\(Z\\) en la función de sobrevivencia de \\(X\\) es el escalamiento del tiempo \\(x\\) a través del factor \\(\\exp(-\\gamma^T Z)\\). Por este motivo a este modelo se le llama modelo de tiempo de fallo acelerado. Su función de riesgo es (ejercicio): \\[h(x|Z)=h_0\\left[x\\exp(-\\gamma^T Z)\\right]\\exp(-\\gamma^T Z)\\]\n\n\n\n\n\n\nEjemplo: Regresión Weibull\n\n\n\nSea \\(X\\sim Weibull(\\lambda, \\alpha)\\). Si \\(Y=\\log X\\) entonces \\(Y=\\mu+\\sigma W\\) donde \\(mu=-\\frac{\\log \\lambda}{\\alpha}\\), \\(\\sigma=\\frac 1 \\alpha\\) y \\(W\\sim \\text{VE-Estandard}\\), es decir: \\[f_W(w)=\\exp\\left(w-e^w\\right)\\qquad w\\in \\mathbb R\\]\nSi \\(Z_1=1\\) en el vector de covariables \\(Z\\), entonces bajo el modelo de regresión Weibull, se puede calcular:\n\\[\\begin{align*}\n    S_Y(y|Z)&=P[Y>y|Z]=P\\left[W>\\frac{y-\\gamma^T Z}{\\sigma}|Z\\right]\\\\\n    &=\\exp\\left[-\\exp\\left[\\frac{y-\\gamma^T Z}{\\sigma}\\right]\\right]\n\\end{align*}\\]\ny cambiando a la variable original \\(X\\):\n\\[\\begin{align*}\nS_X(x|Z)&=\\exp\\left[-\\exp\\left[\\frac{\\log x-\\gamma^T Z}{\\sigma}\\right]\\right]=\\exp\\left[-x^{1/\\sigma}\\exp\\left[-\\frac{\\gamma^T Z}{\\sigma}\\right]\\right]\\\\\n&=\\exp\\left[-\\left[x\\exp(-\\gamma^T Z)\\right]^\\alpha\\right]=S_0(x\\exp(-\\gamma^T Z))\n\\end{align*}\\] donde \\(S_0\\) es la función de sobrevivencia Weibull.\n\n\nEnfoque 2\nModelación de la tasa de riesgo condicional\nEn este enfoque se trabaja con dos tipos de modelos:\n\nModelos con tasa de riesgo multiplicativa:\n\n\\[\\begin{align}\n    h(x|Z)=h_0(x)c(\\beta^T Z)\n    (\\#eq:riesgom)\n\\end{align}\\]\ndonde \\(h_0\\) puede ser una función paramétrica o arbitraria y \\(c\\) es una función arbitraria no-negativa. Cuando\n\\[c(\\beta^T Z)=\\exp(\\beta^T Z)\\]\nal modelo en @ref(eq:riesgom) se le llama Modelo de Cox. Para este último modelo, si existe dos individuos con distinto conjunto de covariables \\(Z_1\\) y \\(Z_2\\). Entonces:\n\\[\\frac{h(x|Z_1)}{h(x|Z_2)}=\\frac{c(\\beta^TZ_1)}{c(\\beta^TZ_2)}\\]\nlo cual es independiente de \\(x\\) (propiedad de riesgos proporcionales). Además, note que\n\\[\\begin{align*}\n    S(x|Z)&=\\exp\\left[-\\int_0^xh(u|Z)du\\right]=\\exp\\left[-c(\\beta^T Z)\\int_0^xh_0(u)du\\right]\\\\\n    &=S_0(x)^{c(\\beta^T Z)}.\n\\end{align*}\\]\n\n\n\n\n\n\nEjemplo: Regresión Weibull\n\n\n\nEn el caso Weibull: \\(h_0(x)=\\alpha \\lambda x^{\\alpha-1}\\) y la función de riesgo condicional en el caso de un modelo de Cox es: \\[h(x|Z)=\\alpha \\lambda x^{\\alpha-1}\\exp(\\beta^T Z)\\]\nNote que en este caso: \\[\\begin{align*}\n    S(x|Z)&=S_0(x)^{c(\\beta^T Z)}\\\\\n    &=\\exp[-\\lambda (x\\exp(\\beta^T Z/\\alpha))^\\alpha]=S_0(x\\exp(\\beta^T Z/\\alpha))\n\\end{align*}\\]\npor lo cual el modelo de regresión Weibull se puede expresar como modelo de tiempo de fallo acelerado o bien como modelo de riesgos proporcionales. (único caso)\n\n\n\nModelos con tasa de riesgo aditiva: \\[h(x|Z)=h_0(x)+\\sum_{j=1}^pZ_j(x)\\beta_j(x)\\]\n\nEste tipo de modelo tiene dificultades extra, por ejemplo los parámetros \\(\\beta_j(x)\\) deben ser seleccionados de manera que la tasa de riesgo \\(h(x|Z)\\) sea positiva. Por otro lado también \\(\\beta_j(x)\\) puede depender del tiempo \\(x\\).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nKlein, John P., and Melvin L. Moeschberger. 2003. Survival analysis : techniques for censored and truncated data. Springer."
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "Referencias",
    "section": "",
    "text": "Klein, John P., and Melvin L. Moeschberger. 2003. Survival analysis : techniques for censored and truncated\ndata. Springer."
  }
]