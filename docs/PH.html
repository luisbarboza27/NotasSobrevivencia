<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Análisis de Sobrevivencia - 3&nbsp; Pruebas de Hipótesis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./RSP.html" rel="next">
<link href="./estNP.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pruebas de Hipótesis</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Análisis de Sobrevivencia</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introducción</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Preliminares.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preliminares</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estNP.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Estimación No-Paramétrica</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PH.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pruebas de Hipótesis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RSP.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regresión Semiparamétrica con Riesgos Proporcionales</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Referencias</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pruebas-de-hipótesis-de-una-muestra" id="toc-pruebas-de-hipótesis-de-una-muestra" class="nav-link active" data-scroll-target="#pruebas-de-hipótesis-de-una-muestra"><span class="toc-section-number">3.1</span>  Pruebas de Hipótesis de una muestra</a></li>
  <li><a href="#pruebas-de-hipótesis-para-más-de-una-muestra" id="toc-pruebas-de-hipótesis-para-más-de-una-muestra" class="nav-link" data-scroll-target="#pruebas-de-hipótesis-para-más-de-una-muestra"><span class="toc-section-number">3.2</span>  Pruebas de Hipótesis para más de una muestra</a></li>
  <li><a href="#pruebas-de-tendencia" id="toc-pruebas-de-tendencia" class="nav-link" data-scroll-target="#pruebas-de-tendencia"><span class="toc-section-number">3.3</span>  Pruebas de tendencia</a></li>
  <li><a href="#pruebas-estratificadas" id="toc-pruebas-estratificadas" class="nav-link" data-scroll-target="#pruebas-estratificadas"><span class="toc-section-number">3.4</span>  Pruebas estratificadas</a></li>
  <li><a href="#pruebas-de-renyi" id="toc-pruebas-de-renyi" class="nav-link" data-scroll-target="#pruebas-de-renyi"><span class="toc-section-number">3.5</span>  Pruebas de Renyi</a></li>
  <li><a href="#pruebas-en-un-punto-fijo-en-el-tiempo" id="toc-pruebas-en-un-punto-fijo-en-el-tiempo" class="nav-link" data-scroll-target="#pruebas-en-un-punto-fijo-en-el-tiempo"><span class="toc-section-number">3.6</span>  Pruebas en un punto fijo en el tiempo</a></li>
  <li><a href="#laboratorio" id="toc-laboratorio" class="nav-link" data-scroll-target="#laboratorio"><span class="toc-section-number">3.7</span>  Laboratorio</a>
  <ul class="collapse">
  <li><a href="#prueba-de-una-muestra" id="toc-prueba-de-una-muestra" class="nav-link" data-scroll-target="#prueba-de-una-muestra"><span class="toc-section-number">3.7.1</span>  Prueba de una muestra</a></li>
  <li><a href="#prueba-de-dos-muestras" id="toc-prueba-de-dos-muestras" class="nav-link" data-scroll-target="#prueba-de-dos-muestras"><span class="toc-section-number">3.7.2</span>  Prueba de dos muestras</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="PH" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pruebas de Hipótesis</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pruebas-de-hipótesis-de-una-muestra" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="pruebas-de-hipótesis-de-una-muestra"><span class="header-section-number">3.1</span> Pruebas de Hipótesis de una muestra</h2>
<p>Supongamos una muestra con censura de tamaño <span class="math inline">\(n\)</span>. Se quiere probar las siguientes hipótesis:</p>
<ul>
<li><span class="math inline">\(H_0:\)</span> La tasa de riesgo de la población es <span class="math inline">\(h_0(t)\)</span> para todo <span class="math inline">\(t \leq \tau\)</span>.</li>
<li><span class="math inline">\(H_1:\)</span> La tasa de riesgo de la población es distinta a <span class="math inline">\(h_0(t)\)</span> para algún <span class="math inline">\(t \leq \tau\)</span>.</li>
</ul>
<p>Donde <span class="math inline">\(h_0(t)\)</span> es una tasa de riesgo conocida en <span class="math inline">\([0,\tau]\)</span> y <span class="math inline">\(\tau\)</span>: máximo de los tiempo de estudio observados.</p>
<p>Considere el estimador de Nelson-Aalen de <span class="math inline">\(H(t)\)</span>:</p>
<p><span class="math display">\[\hat H(t)=\sum_{t_i\leq t}\frac{d_i}{Y(t_i)}\]</span> donde <span class="math inline">\(d_i:\)</span> número de eventos en los tiempos observados <span class="math inline">\(t_1&lt;t_2&lt;\cdots &lt; t_D\)</span> y <span class="math inline">\(Y(t_i)\)</span>: número de individuos en riesgo al tiempo <span class="math inline">\(t_i\)</span>. Un estimador (muy crudo) de <span class="math inline">\(h(t_i)\)</span> es</p>
<p><span class="math display">\[\frac{d_i}{Y(t_i)}\]</span></p>
<p>y este estadístico nos permite definir un estadístico de prueba que busca comparar las tasas de riesgo observadas y esperadas usado diferencias ponderadas. Sea <span class="math inline">\(W(t)\)</span>: función de pesos tal que <span class="math inline">\(W(t)=0\)</span> si <span class="math inline">\(Y(t)=0\)</span>. Defina el siguiente estadístico de prueba:</p>
<p><span class="math display">\[Z(\tau)=O(\tau)-E(\tau)=\sum_{i=1}^DW(t_i)\frac{d_i}{Y(t_i)}-\int_0^\tau W(s)h_0(s)ds\]</span> Bajo <span class="math inline">\(H_0\)</span>, la varianza de <span class="math inline">\(Z(\tau)\)</span> es:</p>
<p><span class="math display">\[V[Z(\tau)]=\int_0^\tau W^2(s)\frac{h_0(s)}{Y(s)}ds\]</span> Si <span class="math inline">\(n\)</span> es grande:</p>
<p><span class="math display">\[\frac{Z(\tau)^2}{V[Z(\tau)]}\underset{H_0}{\sim}\chi_1^2\]</span> Por lo tanto se rechaza <span class="math inline">\(H_0\)</span> si <span class="math inline">\(\frac{Z(\tau)^2}{V[Z(\tau)]}&gt;\chi_{1,1-\alpha}^2\)</span> bajo un nivel de significancia de <span class="math inline">\(\alpha\)</span>.</p>
<p>Si se quiere probar <span class="math inline">\(H_0: h(t)&gt;h_0(t)\)</span> entonces se rechaza <span class="math inline">\(H_0\)</span> si:</p>
<p><span class="math display">\[\frac{Z(\tau)}{\sqrt{V[Z(\tau)]}}&gt;z_{1-\alpha}\]</span> con nivel <span class="math inline">\(\alpha\)</span>. La función de pesos se puede seleccionar de muchas formas, por ejemplo la forma más usual es (<em>Gehan</em>):</p>
<p><span class="math display">\[W(t)=Y(t)\]</span> con lo cual se genera una <em>prueba de rango</em> (Prueba de bondad de ajuste no-paramétrica). Otros casos: (<em>Harrington-Fleming</em>):</p>
<p><span class="math display">\[W(t)=Y(t)S_0(t)^p[1-S_0(t)]^q, \qquad p,q\geq 0\]</span> y <span class="math inline">\(S_0(t)=\exp[-H_0(t)]\)</span>.</p>
<p>En el caso de truncamiento por la izquierda, sea:</p>
<ul>
<li><span class="math inline">\(T_j\)</span>: tiempo de ocurrencia del evento en el <span class="math inline">\(j\)</span>-ésimo paciente.</li>
<li><span class="math inline">\(L_j\)</span>: tiempo de truncamiento por la izquierda en el <span class="math inline">\(j\)</span>-ésimo paciente. Este tiempo se puede interpretar como el momento de entrada en el estudio.</li>
</ul>
<p>Si se usa la opción <span class="math inline">\(W(t)=Y(t)\)</span>, entonces:</p>
<p><span class="math display">\[O(\tau)=\sum_{i=1}^D d_i\]</span></p>
<p>y</p>
<p><span class="math display">\[E(\tau)=\int_0^\tau Y(s)h_0(s)ds = V[Z(\tau)]=\sum_{j=1}^n H_0(T_j)-H_0(L_j)\]</span></p>
</section>
<section id="pruebas-de-hipótesis-para-más-de-una-muestra" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="pruebas-de-hipótesis-para-más-de-una-muestra"><span class="header-section-number">3.2</span> Pruebas de Hipótesis para más de una muestra</h2>
<p>Queremos probar las siguientes alternativas:</p>
<ul>
<li><span class="math inline">\(H_0: h_1(t)=h_2(t)=\cdots=h_k(t)\)</span> para todo <span class="math inline">\(t\leq \tau\)</span></li>
<li><span class="math inline">\(H_1\)</span>: al menos uno de los <span class="math inline">\(h_j(t)\)</span> es diferente para algún <span class="math inline">\(t\leq \tau\)</span>.</li>
</ul>
<p>Sea <span class="math inline">\(\tau\)</span>: tiempo máximo en donde todos los grupos tienen al menos un individuo en riesgo. Normalmente <span class="math inline">\(\tau=\min_k \{\max \{ \text{tiempos de estudio}\}\}\)</span>.</p>
<p>Los datos en este caso constituyen muestras independientes de datos censurados, truncados por la izquierda para cada una de las <span class="math inline">\(k\)</span> poblaciones. Sea <span class="math inline">\(t_1&lt;t_2&lt;\cdots &lt;t_D\)</span> los distintos tiempos de ocurrencia del evento de interés en la muestra combinada.</p>
<p>En tiempo <span class="math inline">\(t_i\)</span> se observa <span class="math inline">\(d_{ij}\)</span> eventos en la <span class="math inline">\(j\)</span>-ésima muestra con <span class="math inline">\(Y_{ij}\)</span>: individuos en riesgo de la población <span class="math inline">\(j\)</span>-ésima (<span class="math inline">\(j=1,\ldots,k\)</span>, <span class="math inline">\(i=1,\ldots,D\)</span>).</p>
<p>Además:</p>
<p><span class="math display">\[d_i=\sum_{j=1}^k d_{ij}\qquad \text{y} \qquad Y_i=\sum_{j=1}^k Y_{ij}\]</span> Si <span class="math inline">\(H_0\)</span> es cierto, un estimador de la tasa de riesgo para la población <span class="math inline">\(j\)</span>-ésima es el estimador combinado:</p>
<p><span class="math display">\[\frac{d_i}{Y_i}\]</span></p>
<p>Si <span class="math inline">\(W_j(t_i)\)</span> denota una función de pesos tal que es cero si <span class="math inline">\(Y_{ij}=0\)</span>, entonces defina el estadístico:</p>
<p><span class="math display">\[Z_j(\tau)=\sum_{j=1}^D W_j(t_i)\left[\frac{d_{ij}}{Y_{ij}}-\frac{d_i}{Y_i}\right]\]</span> Interpretación del estadístico <span class="math inline">\(Z_j(\tau)\)</span>: valores altos dan evidencia de que <span class="math inline">\(H_0\)</span> no es cierto.</p>
<p>En general, se simplifica la ponderación de <span class="math inline">\(Z_j\)</span> al escoger:</p>
<p><span class="math display">\[W_j(t_i)=Y_{ij}W(t_i)\]</span> en donde <span class="math inline">\(W(t_i)\)</span> es un peso en común para toda la muestra combinada. En este caso la diferencia ponderada quedaría:</p>
<p><span class="math display">\[Z_j(\tau)=\sum_{i=1}^D W(t_i)\left[d_{ij}-\underbrace{Y_{ij}\left(\frac{d_i}{Y_i}\right)}_{**}\right]\]</span> donde <span class="math inline">\(**\)</span> es el número de eventos esperados bajo <span class="math inline">\(H_0\)</span>. La varianza de <span class="math inline">\(Z_j(\tau)\)</span> es:</p>
<p><span class="math display">\[\hat \sigma_{jj}=\sum_{i=1}^D W(t_i)^2\frac{Y_{ij}}{Y_i}\left(1-\frac{Y_{ij}}{Y_i}\right)\left(\frac{Y_i-d_i}{Y_i-1}\right)d_i\]</span> para <span class="math inline">\(j=1,\ldots,k\)</span>. La covarianza entre <span class="math inline">\(Z_j(\tau)\)</span> y <span class="math inline">\(Z_g(\tau)\)</span> es:</p>
<p><span class="math display">\[\hat \sigma_{jg}=-\sum_{i=1}^D W(t_i)^2\frac{Y_{ij}}{Y_i}\frac{Y_{ig}}{Y_i}\left(\frac{Y_i-d_i}{Y_i-1}\right)d_i\]</span> El término <span class="math inline">\(\frac{Y_i-d_i}{Y_i-1}\)</span> es igual a 1 si no hay individuos que tengan un tiempo en común de ocurrencia del evento, por lo tanto se puede considerar este término como un factor de correción a la estructura de varianza ante la presencia de múltiples ocurrencias en un mismo tiempo (<em>ties</em>).</p>
<p>Note que <span class="math inline">\((Z_1(\tau),\ldots,Z_k(\tau))\)</span> cumple que:</p>
<p><span class="math display">\[\sum_{j=1}^k Z_j(\tau)=0\]</span></p>
<p>Seleccionamos entonces <span class="math inline">\(k-1\)</span> de las poblaciones y sea <span class="math inline">\(\Sigma\)</span> la matriz de varianza-covarianza con elementos <span class="math inline">\(\hat \sigma_{jg}\)</span>. Se define el estadístico:</p>
<p><span class="math display">\[\chi^2=(Z_1(\tau),\ldots,Z_{k-1}(\tau))\Sigma^{-1}(Z_1(\tau),\ldots,Z_{k-1}(\tau))^T\]</span></p>
<p>Bajo <span class="math inline">\(H_0\)</span> se tiene que <span class="math inline">\(\chi^2\sim \chi_{k-1}^2\)</span>. En el caso en que <span class="math inline">\(k=2\)</span>:</p>
<span class="math display">\[\begin{align*}
    Z&amp;=\frac{\sum_{i=1}^D W(t_i)\left[d_{i1}-Y_{i1}\left(\frac{d_i}{Y_i}\right)\right]}{\sqrt{\sum_{i=1}^D W(t_i)^2\frac{Y_{i1}}{Y_i}\left(1-\frac{Y_{i1}}{Y_i}\right)\left(\frac{Y_i-d_i}{Y_i-1}\right)}}\\
    &amp;\underset{H_0}{\sim} N(0,1)
\end{align*}\]</span>
<p>Por lo tanto se rechaza <span class="math inline">\(H_0: h_1(t)=h_2(t)\)</span> si <span class="math inline">\(|Z|&gt;z_{1-\alpha/2}\)</span> o se rechaza <span class="math inline">\(H_0: h_1(t)&gt;h_2(t)\)</span> si <span class="math inline">\(Z&gt;z_{1-\alpha}\)</span>.</p>
<p>Escogencias de <span class="math inline">\(W(t)\)</span>:</p>
<p>1- <span class="math inline">\(W(t)=1\)</span>: Prueba de log-rango.</p>
<p>2- <span class="math inline">\(W(t_i)=Y_i\)</span>: similar a la prueba de Wilcoxon-Mann-Whitney.</p>
<p>3- <span class="math inline">\(W(t_i)=Y_i^{1/2}\)</span> (otorga más peso donde hay más datos).</p>
<p>4- Considere</p>
<p><span class="math display">\[\tilde S(t)=\prod_{t_i\leq t}\left(1-\frac{d_i}{Y_i+1}\right)\]</span> tome <span class="math inline">\(W(t_i)=\tilde S(t_i)\)</span> (<em>Peto-Peto, (1972)</em>).</p>
<p>5- Modificación de Andersen (1982) (<em>Peto-Peto Modificada</em>)</p>
<p><span class="math display">\[W(t_i)=\frac{\tilde S(t_i)Y_i}{Y_i+1}\]</span> 6- <em>Fleming and Harrington</em></p>
<p>Sea <span class="math inline">\(\hat S(t)\)</span> el estimador de Kaplan-Meier usando la muestra combinada. Defina:</p>
<p><span class="math display">\[W_{p,q}(t_i)=\hat S(t_{i-1})^p[1-\hat S(t_{i-1})]^q, \qquad p\geq 0, q\geq 0\]</span></p>
<p>2 casos: <span class="math inline">\(p=q=0\)</span> (log-rango) y <span class="math inline">\(p=1, q=0\)</span> (Mann-Whitney-Wilcoxon)</p>
</section>
<section id="pruebas-de-tendencia" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="pruebas-de-tendencia"><span class="header-section-number">3.3</span> Pruebas de tendencia</h2>
<p>Principal objetivo: detectar alternativas ordenadas a la hipótesis nula:</p>
<ul>
<li><span class="math inline">\(H_0:h_1(t)=h_2(t)=\cdots=h_k(t)\)</span> para todo <span class="math inline">\(t\leq \tau\)</span></li>
<li><span class="math inline">\(H_1: h_1(t)\leq h_2(t)\leq \cdots\leq h_k(t)\)</span> para <span class="math inline">\(t\leq \tau\)</span> con al menos una desigualdad estricta.</li>
</ul>
<p>Note que</p>
<p><span class="math display">\[h_1(t)\leq \cdots \leq h_k(t) \Leftrightarrow S_1(t)\geq \cdots \geq S_k(t)\]</span> Usando la notación anterior, sea <span class="math inline">\(a_1&lt;a_2&lt;\cdots &lt;a_k\)</span> una secuencia de scores (usualmente <span class="math inline">\(a_j=j\)</span> o algún estadístico representativo para la población <span class="math inline">\(j\)</span>-ésima):</p>
<p><span class="math display">\[Z=\frac{\sum_{j=1}^k a_jZ_j(\tau)}{\sqrt{\sum_{j=1}^k \sum_{g=1}^k a_ja_g\hat \sigma_{jg}}}\underset{H_0}{\sim} N(0,1)\]</span></p>
</section>
<section id="pruebas-estratificadas" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="pruebas-estratificadas"><span class="header-section-number">3.4</span> Pruebas estratificadas</h2>
<p>Suponga que se tiene un conjunto de covariables que definen <span class="math inline">\(M\)</span> estados o configuraciones sobre el conjunto de <span class="math inline">\(k\)</span> poblaciones. Se quiere probar:</p>
<p><span class="math display">\[H_0: h_{1s}(t)=h_{2s}(t)=\cdots=h_{ks}(t), \qquad s=1,\ldots,M\qquad t&lt;\tau\]</span> Para un estrato <span class="math inline">\(s\)</span> fijo, sea <span class="math inline">\(Z_{js}(\tau)\)</span>:</p>
<p><span class="math display">\[Z_{js}(\tau)=\sum_{i=1}^DW(t_i)\left[\underbrace{d_{ij}-Y_{ij}\left(\frac{d_i}{Y_i}\right)}_{\text{solamente estrato s}}\right]\]</span></p>
<p>y <span class="math inline">\(\hat \Sigma_s\)</span> es la matriz de varianza-covarianza de <span class="math inline">\(Z_{js}\)</span>. La prueba estratificada se construye definiendo:</p>
<p><span class="math display">\[Z_{j.}(\tau)=\sum_{s=1}^MZ_{js}(\tau)  \qquad \text{y} \qquad \hat \sigma_{jg.}=\sum_{s=1}^M \hat \sigma_{jgs}\]</span><br>
y <span class="math inline">\(\hat \sigma_{jgs}\)</span> es la entrada <span class="math inline">\(jg\)</span> del <span class="math inline">\(\hat \Sigma_s\)</span>. El estadístico de prueba estaría dado por:</p>
<p><span class="math display">\[X_.=(Z_{1.}(\tau),\ldots,Z_{k-1,.}(\tau))\Sigma_.^{-1}(Z_{1.}(\tau),\ldots,Z_{k-1,.}(\tau))^T\]</span></p>
<p>donde <span class="math inline">\(\Sigma_.\)</span> es la matriz con entradas <span class="math inline">\(\hat \sigma_{jg.}\)</span>. Bajo <span class="math inline">\(H_0\)</span>:</p>
<p><span class="math display">\[X_.\sim \chi_{k-1}^2\]</span></p>
<p>En el caso de dos muestras el estadístico se puede escribir:</p>
<p><span class="math display">\[\frac{\sum_{s=1}^M Z_{1s}(\tau)}{\sqrt{\sum_{s=1}^M \hat \sigma_{11s}}}\underset{H_0}{\sim}N(0,1)\]</span> y este estadístico también permite probar hipótesis de una cola en el caso de dos muestras.</p>
<p>Otro tipo de prueba basada en pruebas estratificadas es una <em>prueba pareada</em>. Si <span class="math inline">\((T_{1i},T_{2i})\)</span> son pares de eventos de interés con indicadores de eventos <span class="math inline">\((\delta_{1i},\delta_{2i})\)</span> para <span class="math inline">\(i=1,\ldots,M\)</span>. Queremos probar las hipótesis:</p>
<p><span class="math display">\[H_0: h_{1i}(t)=h_{2i}(t), \qquad i=1,\ldots,M\]</span> (misma interpretación en términos de estratos). En este caso el estadístico <span class="math inline">\(Z_{js}\)</span> es: (<span class="math inline">\(j=1,2\)</span>)</p>
<span class="math display">\[\begin{align*}
Z_{1i}(\tau)=
    \begin{cases}
        W(T_{1i})\left(1-\frac 1 2\right)=\frac{W(T_{1i})}{2} &amp; \text{bajo Escenario A}\\
        W(T_{2i})\left(0-\frac 1 2\right)=-\frac{W(T_{2i})}{2} &amp; \text{bajo Escenario B}\\
        0 &amp; \text{otro caso}
    \end{cases}
\end{align*}\]</span>
<ul>
<li>Escenario A: si <span class="math inline">\(T_{1i}&lt;T_{2i}\)</span>, <span class="math inline">\(\delta_{1i}=1\)</span> o <span class="math inline">\(T_{1i}=T_{2i}\)</span>, <span class="math inline">\(\delta_{1i}=1\)</span>, <span class="math inline">\(\delta_{2i}=0\)</span>.</li>
<li>Escenario B: <span class="math inline">\(T_{2i}&lt;T_{1i}\)</span>, <span class="math inline">\(\delta_{2i}=1\)</span> o <span class="math inline">\(T_{1i}=T_{2i}\)</span>, <span class="math inline">\(\delta_{2i}=1\)</span>, <span class="math inline">\(\delta_{1i}=0\)</span>.</li>
</ul>
<p>y</p>
<span class="math display">\[\begin{align*}
\hat \sigma_{11i}=
    \begin{cases}
        W(T_{1i})^2/4 &amp; \text{bajo Escenario A}\\
        W(T_{2i})^2/4 &amp; \text{bajo Escenario B}\\
        0 &amp; \text{otro caso}
    \end{cases}
\end{align*}\]</span>
<p>Sumando sobre los estratos (<span class="math inline">\(i=1,\ldots,M\)</span>):</p>
<p><span class="math display">\[Z_{1.}(\tau)=w \cdot \frac{D_1-D_2}{2}\]</span> y</p>
<p><span class="math display">\[\hat \sigma_{11.}=w^2\cdot \frac{D_1+D_2}{4}\]</span> donde:</p>
<ul>
<li><span class="math inline">\(D_1\)</span>: número de parejas en donde el evento aparece en el sujeto de la primera muestra.</li>
<li><span class="math inline">\(D_2\)</span>: número de parejas en donde el evento aparece en el sujeto de la segunda muestra.</li>
<li><span class="math inline">\(w\)</span>: peso evaluado en el tiempo más pequeño de ocurrencia del evento.</li>
</ul>
<p>Entonces:</p>
<p><span class="math display">\[\frac{Z_{1.}(\tau)}{\sqrt{\hat \sigma_{11.}}}=\frac{D_1-D_2}{\sqrt{D_1+D_2}}\underset{H_0}{\sim}N(0,1)\]</span></p>
</section>
<section id="pruebas-de-renyi" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="pruebas-de-renyi"><span class="header-section-number">3.5</span> Pruebas de Renyi</h2>
<p><em>Inconveniente de las pruebas anteriores</em>: algunas veces las diferencias en las tasas de riesgo son simétricas (un primer grupo sobrepasa al otro en riesgo un número similar de veces al que el primer grupo es sobrepasado por el otro grupo). Esto provoca problemas de potencia en la prueba. <em>Solución</em>: utilizar otras medidas de comparación.</p>
<p>Suponga que se tiene dos muestras independientes de tamaño <span class="math inline">\(n_1\)</span> y <span class="math inline">\(n_2\)</span> respectivamente.</p>
<p>Sea <span class="math inline">\(n=n_1+n_2\)</span> y <span class="math inline">\(t_1&lt;t_2&lt;\cdots&lt;t_D\)</span> los distintos tiempo de ocurrencia en la muestra combinada y <span class="math inline">\(Y_{ij}\)</span>: número de individuos en riesgo en tiempo <span class="math inline">\(t_i\)</span> (<span class="math inline">\(j=1,2\)</span>). Al igual que antes <span class="math inline">\(Y_i=Y_{i1}+Y_{i2}\)</span>, <span class="math inline">\(d_i=d_{i1}+d_{i2}\)</span> (eventos ocurridos). Sea <span class="math inline">\(W(t)\)</span> la función de pesos (como las consideradas anteriormente). En este caso se calcula:</p>
<p><span class="math display">\[Z(t_i)=\sum_{t_k\leq t_i}W(t_k)\left[d_{k1}-Y_{k1}\left(\frac{d_k}{Y_k}\right)\right]\qquad i=1,\ldots,D\]</span> y</p>
<p><span class="math display">\[\sigma(\tau)=\sum_{t_k\leq \tau}W(t_k)^2\left(\frac{Y_{k1}}{Y_k}\right)\left(\frac{Y_{k2}}{Y_k}\right)\left(\frac{Y_{k}-d_k}{Y_k-1}\right)d_k\]</span> donde <span class="math inline">\(\tau\)</span> es el <span class="math inline">\(t_k\)</span> máximo tal que <span class="math inline">\(Y_{k1}, Y_{k2}&gt;0\)</span>.</p>
<p>Bajo la hipótesis:</p>
<ul>
<li><span class="math inline">\(H_0: h_1(t)=h_2(t),\qquad t&lt;\tau\)</span></li>
<li><span class="math inline">\(H_1: h_1(t)\neq h_2(t)\)</span></li>
</ul>
<p>el estadístico de prueba es:</p>
<p><span class="math display">\[Q=\sup_{t\leq \tau}\frac{|Z(t)|}{\sigma(\tau)}\]</span> cuya distribución bajo <span class="math inline">\(H_0\)</span> se aproxima con la distribución de <span class="math inline">\(\sup_{0\leq x\leq 1}|B(x)|\)</span> donde <span class="math inline">\(B\)</span> es un proceso Browniano estándar.</p>
</section>
<section id="pruebas-en-un-punto-fijo-en-el-tiempo" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="pruebas-en-un-punto-fijo-en-el-tiempo"><span class="header-section-number">3.6</span> Pruebas en un punto fijo en el tiempo</h2>
<p><em>Objetivo</em>: hacer comparaciones de funciones de sobrevivencia o curvas de incidencia de <span class="math inline">\(k\)</span> poblaciones en un punto fijo en el tiempo <span class="math inline">\(t_0\)</span>.</p>
<p>Sea <span class="math inline">\(\Theta^T=(\theta_1,\ldots,\theta_p)\)</span> un vector de parámetros de dimensión <span class="math inline">\(p\)</span>. Definimos un contraste como un conjunto de coeficientes <span class="math inline">\(c=(c_1,\ldots,c_p)\)</span> que definen una combinación lineal de parámetros <span class="math inline">\(\theta^c=c\Theta=c_1\theta_1+\cdots+c_p\theta_p\)</span>.</p>
<p><strong>Ejemplo</strong>: si <span class="math inline">\(p=3\)</span> y <span class="math inline">\(c=(1,-1,0)\)</span>, entonces <span class="math inline">\(\theta^c=\theta_1-\theta_2\)</span>. Decir que <span class="math inline">\(H_0: \theta^c=0\)</span> es equivalente a decir que <span class="math inline">\(H_0:\theta_1=\theta_2\)</span>.</p>
<p>Suponga que se tiene <span class="math inline">\(q\)</span> contrastes <span class="math inline">\(c_k=(c_{k1},\ldots,c_{kp})\)</span> para <span class="math inline">\(k=1,\ldots,q\)</span> y se tiene que probar las hipótesis:</p>
<p><span class="math display">\[H_0: c_k\Theta=0\qquad \forall k\]</span> Defina la matriz de contrastes:</p>
<span class="math display">\[\begin{align*}
C=
    \begin{pmatrix}
    c_1\\
    \vdots \\
    c_q
    \end{pmatrix}
\end{align*}\]</span>
<p>Si <span class="math inline">\(\hat \theta_j\)</span> es el estimador de <span class="math inline">\(\theta_j\)</span> con matriz de varianza <span class="math inline">\(V\)</span> (con entradas <span class="math inline">\(\hat V(\hat \theta_j,\hat \theta_k)\)</span>) (<span class="math inline">\(V\)</span>: varianza). Entonces si se quiere probar:</p>
<p><span class="math display">\[H_0: C\Theta^T=0\]</span></p>
<p>El estadístico de prueba es:</p>
<p><span class="math display">\[X^2=[C\Theta]^T[CVC^T]^{-1}[C\Theta]\underset{H_0}{\sim}\chi_q^2\]</span> Caso particular:</p>
<ul>
<li><span class="math inline">\(H_0: S_1(t_0)=S_2(t_0)=\cdots S_k(t_0)\)</span> vs <span class="math inline">\(H_1\)</span>: al menos uno de los <span class="math inline">\(S_j(t_0)\)</span> es distinto.</li>
<li><span class="math inline">\(H_0: CI_1(t_0)=CI_2(t_0)=\cdots =CI_k(t_0)\)</span> vs <span class="math inline">\(H_1\)</span>: al menos uno de los <span class="math inline">\(CI_j(t_0)\)</span> es distinto.</li>
</ul>
<p>Sea <span class="math inline">\(\hat \theta_j\)</span> el estimador de Kaplan-Meier de <span class="math inline">\(S_j(t_0)\)</span> o la curva de incidencia estimada en <span class="math inline">\(t_0\)</span>. Sea</p>
<span class="math display">\[\begin{align*}
C=
    \begin{pmatrix}
      1 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; -1 \\
      0 &amp; 1 &amp; 0 &amp; \cdots &amp; 0 &amp; -1 \\
      \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
      0 &amp; 0 &amp; 0 &amp; \cdots &amp; 1 &amp; -1
    \end{pmatrix}
\end{align*}\]</span>
<p>y <span class="math inline">\(V=\text{diag}(\hat V(\hat \theta_k(t_0)))\)</span>. Entonces:</p>
<span class="math display">\[\begin{align*}
X^2&amp;=
    \begin{pmatrix}
        \hat \theta_1-\hat \theta_p\\
        \vdots\\
        \hat \theta_{p-1}-\hat \theta_p
    \end{pmatrix}^T
    \begin{pmatrix}
        V_1+V_p &amp; V_p &amp; \cdots &amp; V_p \\
        V_p &amp; V_2+V_p &amp; \cdots &amp; V_p \\
        \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
        V_p &amp; V_p &amp; \cdots &amp; V_{p-1}+V_p
    \end{pmatrix}^{-1}
    \begin{pmatrix}
        \hat \theta_1-\hat \theta_p\\
        \vdots\\
        \hat \theta_{p-1}-\hat \theta_p
    \end{pmatrix}\\
    &amp; \underset{H_0}{\sim} \chi_{p-1}^2
\end{align*}\]</span>
<p>Caso particular (p=2):</p>
<p>Con la hipótesis nula <span class="math inline">\(H_0: S_1(t_0)=S_2(t_0)\)</span>:</p>
<p><span class="math display">\[Z=\frac{\hat S_1(t_0)-\hat S_2(t_0)}{\sqrt{\hat V(\hat S_1(t_0))+\hat V(\hat S_2(t_0))}}\underset{H_0}{\sim}N(0,1)\]</span> <strong>Nota</strong>: Si se quiere hacer comparaciones simultáneas (<span class="math inline">\(k\)</span> en total, 2 a 2) se puede usar un factor de corrección de <em>Bonferroni</em> (Ejercicio).</p>
</section>
<section id="laboratorio" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="laboratorio"><span class="header-section-number">3.7</span> Laboratorio</h2>
<section id="prueba-de-una-muestra" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="prueba-de-una-muestra"><span class="header-section-number">3.7.1</span> Prueba de una muestra</h3>
<p>Carga de paquetes básicos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(KMsurv)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survMisc)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este cálculo busca replicar el ejemplo 7.1 en donde se compara la mortalidad en una muestra de 26 pacientes psiquiátricos en Iowa con respecto a la mortalidad general de la población del mismo estado en el año 1960. Primero cargamos los datos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"psych"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sex age time death
1   2  51    1     1
2   2  58    1     1
3   2  55    2     1
4   2  28   22     1
5   1  21   30     0
6   1  19   28     1</code></pre>
</div>
</div>
<p>y cargamos la información de la mortalidad de todo Iowa (1:Hombres, 2:Mujeres):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Iowa_mort <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'Iowa_1960.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 60 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (3): Age, Survival_males, Survival_females

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Iowa_mort) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'age'</span>,<span class="st">'1'</span>,<span class="st">'2'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Iowa_mort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
    age   `1`   `2`
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    18 0.964 0.974
2    19 0.962 0.973
3    20 0.961 0.973
4    21 0.959 0.972
5    22 0.957 0.972
6    23 0.956 0.971</code></pre>
</div>
</div>
<p>Después de algunos cambios, unimos las dos fuentes de información:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Iowa_mort <span class="ot">&lt;-</span> Iowa_mort <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>age,<span class="at">names_to =</span> <span class="st">'sex'</span>,<span class="at">values_to =</span> <span class="st">'Survival'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex=</span><span class="fu">as.numeric</span>(sex))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>psych <span class="ot">&lt;-</span> psych <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(Iowa_mort) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">age2=</span>age<span class="sc">+</span>time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(sex, age)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sex age time death Survival age2
1   2  51    1     1  0.92756   52
2   2  58    1     1  0.89304   59
3   2  55    2     1  0.90942   57
4   2  28   22     1  0.96805   50
5   1  21   30     0  0.95919   51
6   1  19   28     1  0.96246   47</code></pre>
</div>
</div>
<p>Se maneja dos distintas situaciones bajo estos datos censurados por la derecha: (1) truncamiento por la izquierda o (2) ningún truncamiento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(psych)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>surv_7_1 <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> age,<span class="at">time2 =</span> age2,<span class="at">event =</span> death,<span class="at">type =</span> <span class="st">'counting'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>surv_7_1_b <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> age2,<span class="at">event =</span> death)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si queremos comparar las dos distribuciones sin asumir truncamiento por la izquierda se puede ejecutar:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>S_7_1_b <span class="ot">&lt;-</span> <span class="fu">survdiff</span>(surv_7_1_b<span class="sc">~</span><span class="fu">offset</span>(Survival))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>S_7_1_b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = surv_7_1_b ~ offset(Survival))

 Observed  Expected         Z         p 
 1.40e+01  1.40e+00 -1.06e+01  1.89e-26 </code></pre>
</div>
</div>
<p>En donde concluimos que la mortalidad de los pacientes es distinta a la resto del estado bajo los niveles de significancia usuales. En el caso de truncamiento por la izquierda, hacemos el cálculo de manera directa:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>psych <span class="ot">&lt;-</span> psych <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">H=</span><span class="sc">-</span><span class="fu">log</span>(Survival))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>Iowa_mort <span class="ot">&lt;-</span> Iowa_mort <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">age2=</span>age,sex,<span class="at">Survival2=</span>Survival)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>psych <span class="ot">&lt;-</span> psych <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(Iowa_mort) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">H2=</span><span class="sc">-</span><span class="fu">log</span>(Survival2)) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif=</span>H2<span class="sc">-</span>H)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(sex, age2)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Otau <span class="ot">&lt;-</span> <span class="fu">sum</span>(psych<span class="sc">$</span>death)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Etau <span class="ot">&lt;-</span> <span class="fu">sum</span>(psych<span class="sc">$</span>dif)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> (Otau<span class="sc">-</span>Etau)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>Etau</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>valor_p <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> X2,<span class="at">df =</span> <span class="dv">1</span>,<span class="at">lower.tail =</span> F)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(valor_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.014724e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por lo que llegamos a la misma conclusión.</p>
</section>
<section id="prueba-de-dos-muestras" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="prueba-de-dos-muestras"><span class="header-section-number">3.7.2</span> Prueba de dos muestras</h3>
<p>El primer conjunto de datos mide la efectividad de dos técnicas distintas de colocación de catéteres en procedimientos de diálisis en riñones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"kidney"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(kidney)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time delta type
1  1.5     1    1
2  3.5     1    1
3  4.5     1    1
4  4.5     1    1
5  5.5     1    1
6  8.5     1    1</code></pre>
</div>
</div>
<p>Primero estimamos las funciones de sobrevivencia según Kaplan-Meier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(kidney)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggpubr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'survminer'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:survival':

    myeloma</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>surv_7_2 <span class="ot">&lt;-</span> <span class="fu">Surv</span>(time,<span class="at">event =</span> delta)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>S_7_2 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_7_2<span class="sc">~</span>type,<span class="at">data =</span> kidney)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(S_7_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PH_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Y comparamos las tasas de riesgo bajo los dos procedimientos bajo distintas escogencias de funciones de pesos <span class="math inline">\(W(t)\)</span> (log-rank, Peto-Peto y tres posibilidades de escogencia de Fleming-Harrington):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>X_7_2_logrank <span class="ot">&lt;-</span> <span class="fu">survdiff</span>(surv_7_2<span class="sc">~</span>type,<span class="at">data =</span> kidney,<span class="at">rho =</span> <span class="dv">0</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>X_7_2_logrank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = surv_7_2 ~ type, data = kidney, rho = 0)

        N Observed Expected (O-E)^2/E (O-E)^2/V
type=1 43       15       11      1.42      2.53
type=2 76       11       15      1.05      2.53

 Chisq= 2.5  on 1 degrees of freedom, p= 0.1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>X_7_2_PetoPeto <span class="ot">&lt;-</span> <span class="fu">survdiff</span>(surv_7_2<span class="sc">~</span>type,<span class="at">data =</span> kidney,<span class="at">rho =</span> <span class="dv">1</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>X_7_2_PetoPeto</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = surv_7_2 ~ type, data = kidney, rho = 1)

        N Observed Expected (O-E)^2/E (O-E)^2/V
type=1 43     12.0     9.48     0.686      1.39
type=2 76     10.4    12.98     0.501      1.39

 Chisq= 1.4  on 1 degrees of freedom, p= 0.2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FHtest) <span class="co"># http://www.bioconductor.org/packages/release/bioc/html/Icens.html</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: interval</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: perm</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Icens</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MLEcens</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Depends on Icens package available on bioconductor. 
To install use for example:
install.packages('BiocManager')
BiocManager::install('Icens')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>X_7_2_FH1 <span class="ot">&lt;-</span> <span class="fu">FHtestrcc</span>(surv_7_2<span class="sc">~</span>type,<span class="at">data =</span> kidney,<span class="at">rho =</span> <span class="dv">0</span>,<span class="at">lambda=</span><span class="dv">1</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>X_7_2_FH1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two-sample test for right-censored data

Parameters: rho=0, lambda=1
Distribution: counting process approach

Data: surv_7_2 by type

        N Observed Expected   O-E (O-E)^2/E (O-E)^2/V
type=1 43    2.973     1.56  1.41      1.28      9.67
type=2 76    0.565     1.98 -1.41      1.01      9.67

Statistic Z= -3.1, p-value= 0.00188
Alternative hypothesis: survival functions not equal</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>X_7_2_FH2 <span class="ot">&lt;-</span> <span class="fu">FHtestrcc</span>(surv_7_2<span class="sc">~</span>type,<span class="at">data =</span> kidney,<span class="at">rho =</span> <span class="dv">1</span>,<span class="at">lambda=</span><span class="dv">0</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>X_7_2_FH2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two-sample test for right-censored data

Parameters: rho=1, lambda=0
Distribution: counting process approach

Data: surv_7_2 by type

        N Observed Expected   O-E (O-E)^2/E (O-E)^2/V
type=1 43     12.0     9.48  2.55     0.686      1.39
type=2 76     10.4    12.98 -2.55     0.501      1.39

Statistic Z= -1.2, p-value= 0.239
Alternative hypothesis: survival functions not equal</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>X_7_2_FH3 <span class="ot">&lt;-</span> <span class="fu">FHtestrcc</span>(surv_7_2<span class="sc">~</span>type,<span class="at">data =</span> kidney,<span class="at">rho =</span> <span class="dv">1</span>,<span class="at">lambda=</span><span class="dv">1</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>X_7_2_FH3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two-sample test for right-censored data

Parameters: rho=1, lambda=1
Distribution: counting process approach

Data: surv_7_2 by type

        N Observed Expected   O-E (O-E)^2/E (O-E)^2/V
type=1 43     2.21     1.19  1.02     0.875      9.83
type=2 76     0.48     1.50 -1.02     0.694      9.83

Statistic Z= -3.1, p-value= 0.00171
Alternative hypothesis: survival functions not equal</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(kidney)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Noten que bajo algunas escogencias de pesos no hay evidencia suficiente para rechazar la igualdad entre tasas de riesgos.</p>
<p>El ejemplo 7.3 del Klein busca comparar dos tasas de riesgo bajo un esquema de truncamiento por la izquierda. En este caso se usa los datos de la casa de retiro Channing, que anteriormente habíamos usado para comparar entre hombres y mujeres la sobrevivencia de adultos mayores. Ahora se busca probar <span class="math inline">\(H_0:h_F(t)=h_M(t)\)</span> contra la alternativa de una cola <span class="math inline">\(H_A:h_F(t)\leq h_M(t)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"channing"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(channing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  obs death ageentry  age time gender
1   1     1     1042 1172  130      2
2   2     1      921 1040  119      2
3   3     1      885 1003  118      2
4   4     1      901 1018  117      2
5   5     1      808  932  124      2
6   6     1      915 1004   89      2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(channing)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>surv_7_3 <span class="ot">&lt;-</span> <span class="fu">Surv</span>(<span class="at">time =</span> ageentry,<span class="at">time2 =</span> age,<span class="at">event =</span> death,<span class="at">type =</span> <span class="st">'counting'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in Surv(time = ageentry, time2 = age, event = death, type =
"counting"): Stop time must be &gt; start time, NA created</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>S_7_3 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(surv_7_3<span class="sc">~</span>gender)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(S_7_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = surv_7_3 ~ gender)

  n= 458, number of events= 176 
   (4 observations deleted due to missingness)

          coef exp(coef) se(coef)      z Pr(&gt;|z|)  
gender -0.3163    0.7289   0.1731 -1.827   0.0677 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

       exp(coef) exp(-coef) lower .95 upper .95
gender    0.7289      1.372    0.5191     1.023

Concordance= 0.528  (se = 0.018 )
Likelihood ratio test= 3.17  on 1 df,   p=0.07
Wald test            = 3.34  on 1 df,   p=0.07
Score (logrank) test = 3.36  on 1 df,   p=0.07</code></pre>
</div>
</div>
<p>En este caso el estadístico de prueba corresponde al de la prueba Score (3.36). Como la prueba es de una cola, el valor p se puede calcular directamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fu">sqrt</span>(<span class="fl">3.36</span>),<span class="at">lower.tail =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03339903</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(channing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lo que da evidencia de que bajo un nivel de confianza en la muestra del 95%, podríamos rechazar la hipótesis de que las dos tasas de riesgo son idénticas a favor de que de las mujeres es mayor a la de los hombres.</p>
<p>El ejemplo 7.4 usa los datos de 137 pacientes que iban a someterse a un transplante de médula ósea bajo tres distintas condiciones de leucemia (ALL, AML-low, AML-high). Vamos a comparar la sobrevivencia de los pacientes bajo estos tres grupos de riesgo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"bmt"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bmt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group   t1   t2 d1 d2 d3   ta da  tc dc tp dp z1 z2 z3 z4 z5 z6   z7 z8 z9
1     1 2081 2081  0  0  0   67  1 121  1 13  1 26 33  1  0  1  1   98  0  1
2     1 1602 1602  0  0  0 1602  0 139  1 18  1 21 37  1  1  0  0 1720  0  1
3     1 1496 1496  0  0  0 1496  0 307  1 12  1 26 35  1  1  1  0  127  0  1
4     1 1462 1462  0  0  0   70  1  95  1 13  1 17 21  0  1  0  0  168  0  1
5     1 1433 1433  0  0  0 1433  0 236  1 12  1 32 36  1  1  1  1   93  0  1
6     1 1377 1377  0  0  0 1377  0 123  1 12  1 22 31  1  1  1  1 2187  0  1
  z10
1   0
2   0
3   0
4   0
5   0
6   0</code></pre>
</div>
</div>
<p>Las funciones de sobrevivencia estimadas se grafican:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>S_7_4 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(<span class="at">time=</span>t2, <span class="at">event=</span>d3) <span class="sc">~</span> group, <span class="at">data=</span>bmt)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(S_7_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PH_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>y probamos la hipótesis de la igualdad de tasas de riesgo entre los tres grupos, usando tres posibilidades de escogencia de parámetros de Fleming-Harrington, y bajo las opciones de log-rank y Gehan:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">ten</span>(<span class="fu">Surv</span>(<span class="at">time=</span>t2, <span class="at">event=</span>d3) <span class="sc">~</span> group, <span class="at">data=</span>bmt)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>pruebas_7_4 <span class="ot">&lt;-</span> <span class="fu">comp</span>(b1, <span class="at">p=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">q=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             chiSq df pChisq
1          13.8037  2      6
n          16.2407  2      1
sqrtN      15.6529  2      5
S1         15.7260  2      3
S2         15.7781  2      2
FH_p=1_q=0 15.6725  2      4
FH_p=0_q=1  6.1097  2      8
FH_p=1_q=1  9.9331  2      7
$tft
                     Q         Var        Z pNorm
1             -10.6695     42.7801 -1.63127     6
n           -1294.0000 439987.8847 -1.95081     1
sqrtN        -118.1769   4202.2583 -1.82302     5
S1             -9.2667     23.2023 -1.92379     3
S2             -9.1996     22.7588 -1.92839     2
FH_p=1_q=0     -9.3529     23.6462 -1.92339     4
FH_p=0_q=1     -1.3166      4.5757 -0.61551     8
FH_p=1_q=1     -1.0948      1.4957 -0.89516     7

$scores
[1] 1 2 3</code></pre>
</div>
</div>
<p>Note que en esta versión del paquete <em>survMisc</em> los valores p no son calculados correctamente. Por ejemplo, para el caso de la prueba con pesos de Gehan este se podría calcular como:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="fl">16.2407</span>,<span class="at">df =</span> <span class="dv">2</span>,<span class="at">lower.tail =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0002974245</code></pre>
</div>
</div>
<p>Por lo tanto bajo los niveles de confianza usuales se rechaza la hipótesis de que las tres tasas de riesgo son iguales para cualquier <span class="math inline">\(t\)</span>.</p>
<!-- ### Pruebas de tendencia -->
<!-- Como ejemplo de la prueba de tendencia se utiliza una base de 40 -->
<!-- pacientes con cáncer de laringe clasificados según la etapa de la -->
<!-- enfermedad. Se probará la hipótesis de que no hay una diferencia entre -->
<!-- las tasas de riesgo entre las 4 etapas vs la hipótesis de que entre más -->
<!-- alta la etapa, más alta la tasa de riesgo. Graficamos las 4 funciones de -->
<!-- sobrevivencia estimadas: -->
<!-- ```{r} -->
<!-- data("larynx") -->
<!-- S_7_6 <- survfit(Surv(time, delta) ~ stage,data=larynx) -->
<!-- ggsurvplot(S_7_6) -->
<!-- ``` -->
<!-- y el estadístico de prueba lo calculamos con la función *comp*, usando -->
<!-- como scores $a_j=j, \; 1,\ldots,4$ y bajo distintas escogencias de -->
<!-- funciones de pesos: -->
<!-- ```{r} -->
<!-- l1 <- ten(Surv(time, delta) ~ stage, data=larynx) -->
<!-- comp(l1) -->
<!-- p <- attr(l1, "tft") -->
<!-- p$tft$pChisq -->
<!-- ``` -->
<!-- Por ejemplo para el caso de la prueba con pesos de Tarone, el valor p -->
<!-- es: -->
<!-- ```{r} -->
<!-- 2*pnorm(4.0580,lower.tail = F) -->
<!-- ``` -->
<!-- por lo que se rechaza la hipótesis nula inmediatamente, a favor de una -->
<!-- en donde las tasas son crecientes. -->
<!-- ### Pruebas estratificadas -->
<!-- Como complemento al ejemplo de la sobrevivencia en pacientes con -->
<!-- leucemia, se incluye la covariable de uso del químico MTX como -->
<!-- profiláctico en el tratamiento, el cual puede ser una variable confusora -->
<!-- en la prueba del ejemplo 7.4. -->
<!-- ```{r} -->
<!-- S_7_4_est <- survfit(Surv(time=t2, event=d3) ~ group+strata(z10), data=bmt) -->
<!-- ggsurvplot(S_7_4_est) -->
<!-- ``` -->
<!-- y hacemos una prueba de log-rango con el paquete *survival*: -->
<!-- ```{r} -->
<!-- Prueba_7_4_est <- survdiff(Surv(time=t2, event=d3) ~ group+strata(z10), data=bmt) -->
<!-- print(Prueba_7_4_est) -->
<!-- ``` -->
<!-- por lo tanto se rechaza la hipótesis nula de igualdad de tasas de -->
<!-- riesgo, independientemente del efecto del uso del químico MTX en la -->
<!-- población de estudio. -->
<!-- ### Prueba de Renyi -->
<!-- Para ilustrar el uso de la prueba de Renyi usamos los datos de -->
<!-- sobrevivencia de 45 pacientes con cáncer gástrico a los cuales se les -->
<!-- aplicó quimioterapia o la combinación de quimioterapia y radiación. Las -->
<!-- funciones de sobrevivencia estimadas son: -->
<!-- ```{r} -->
<!-- data("gastric") -->
<!-- S_7_9_est <- survfit(Surv(time, event) ~ group, data=gastric) -->
<!-- ggsurvplot(S_7_9_est) -->
<!-- ``` -->
<!-- donde es muy evidente que las dos funciones de sobrevivencia se cruzan -->
<!-- en una edad intermedia, por lo que es mejor usar la prueba de Renyi: -->
<!-- ```{r} -->
<!-- g1 <- ten(Surv(time, event) ~ group, data=gastric) -->
<!-- pba <- comp(g1) -->
<!-- attr(g1, "sup") -->
<!-- p <- attr(g1, "sup") -->
<!-- ``` -->
<!-- y los valores p correspondientes para cada una de las escogencias de pesos son: -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- p$pSupBr -->
<!-- ``` -->
<!-- Por lo que rechazaríamos la hipótesis de igualdad de tasas de riesgo -->
<!-- para niveles de significacia superiores al 5% aproximadamente para todos los casos excepto la primera y la última ponderación. -->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./estNP.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Estimación No-Paramétrica</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./RSP.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regresión Semiparamétrica con Riesgos Proporcionales</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>